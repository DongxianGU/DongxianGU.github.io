<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 4.2.1">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"yoursite.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":false,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="Life,Happy,Code">
<meta property="og:type" content="website">
<meta property="og:title" content="Summer So Cold">
<meta property="og:url" content="http://yoursite.com/index.html">
<meta property="og:site_name" content="Summer So Cold">
<meta property="og:description" content="Life,Happy,Code">
<meta property="og:locale" content="zh_CN">
<meta property="article:author" content="DongxianGu">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://yoursite.com/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : true,
    isPost : false,
    lang   : 'zh-CN'
  };
</script>

  <title>Summer So Cold</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">Summer So Cold</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content index posts-expand">
            
      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/18/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/18/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" class="post-title-link" itemprop="url">背包问题</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-18 19:59:00 / 修改时间：22:36:17" itemprop="dateCreated datePublished" datetime="2020-05-18T19:59:00+08:00">2020-05-18</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构和算法</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/18/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/18/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>背包问题泛指以下这一种问题：给定一组有固定价值和固定重量的物品，以及一个已知最大承重量的背包，求在不超过背包最大承重量的前提下，能放进背包里面的物品的最大总价值。这一类问题是典型的使用动态规划解决的问题，我们可以把背包问题分成3种不同的子问题：0-1背包问题、完全背包和多重背包问题。下面对这三种问题分别进行讨论。</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/18/%E8%83%8C%E5%8C%85%E9%97%AE%E9%A2%98/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/11/%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E4%B9%8BPCNN/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/11/%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E4%B9%8BPCNN/" class="post-title-link" itemprop="url">关系抽取之PCNN</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-11 09:23:34 / 修改时间：17:39:51" itemprop="dateCreated datePublished" datetime="2020-05-11T09:23:34+08:00">2020-05-11</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/" itemprop="url" rel="index"><span itemprop="name">知识图谱</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/11/%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E4%B9%8BPCNN/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/11/%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E4%B9%8BPCNN/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>知识图谱关系抽取 PCNN (Piece-Wise-CNN)</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/11/%E5%85%B3%E7%B3%BB%E6%8A%BD%E5%8F%96%E4%B9%8BPCNN/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/08/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/08/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/" class="post-title-link" itemprop="url">知识图谱</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-08 11:12:01" itemprop="dateCreated datePublished" datetime="2020-05-08T11:12:01+08:00">2020-05-08</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-11 16:09:32" itemprop="dateModified" datetime="2020-05-11T16:09:32+08:00">2020-05-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/08/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/08/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <p>知识图谱相关知识</p>
          <!--noindex-->
            <div class="post-button">
              <a class="btn" href="/2020/05/08/%E7%9F%A5%E8%AF%86%E5%9B%BE%E8%B0%B1/">
                阅读全文 &raquo;
              </a>
            </div>
          <!--/noindex-->
        
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/07/CRF/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/07/CRF/" class="post-title-link" itemprop="url">CRF</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-05-07 12:11:32 / 修改时间：12:25:56" itemprop="dateCreated datePublished" datetime="2020-05-07T12:11:32+08:00">2020-05-07</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%9C%BA%E5%99%A8%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">机器学习</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/07/CRF/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/07/CRF/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="CRF-原理和实现"><a href="#CRF-原理和实现" class="headerlink" title="CRF 原理和实现"></a>CRF 原理和实现</h1><blockquote>
<p>条件随机场(Conditional Random Field,CRF)，<br>给定一组输入随机变量条件下另一组输出随机变量的条件概率分布模型，其特点是假设输出随机变量构成马尔可夫随机场。</p>
</blockquote>
<p>CRF可以用于不同的预测问题，比如序列标注问题。</p>
<p>序列标注问题，因此主要是线性链条件随机场，问题变成了由输入序列对输出序列预测的判别模型。</p>
<p>学习方法通常是：极大似然估计或正则化的极大似然估计</p>
<h2 id="概率无向图模型"><a href="#概率无向图模型" class="headerlink" title="概率无向图模型"></a>概率无向图模型</h2><p>probabilistic undirected graphical model，又称马尔可夫随机场(Markov Random Field)，是一个可以使用无向图表示的联合概率分布。</p>
<p>定义：概率无向图<br>设有联合概率分布$P(Y)$,由无向图$\mathbf{G=(V,E)}$表示，在图中，结点表示随机变量，边表示随机变量之间的依赖关系。如果联合概率分布$P(Y)$满足成对、局部或全局马尔可夫性，则称此联合概率分布为概率无向图模型或马尔可夫随机场。</p>
<p>定义：团和最大团</p>
<p>无向图$\mathbf{G}$中中任何两个结点均有边连接的结点子集称为团，若$\mathbf{C}$是无向图$\mathbf{G}$中的一个团，并且不能再加进任何一个$\mathbf{G}$的结点使其成为一个更大的团，则称$\mathbf{C}$为最大团。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">graph TB</span><br><span class="line"> D1((Y1))</span><br><span class="line"> D2((Y2))</span><br><span class="line"> D3((Y3))</span><br><span class="line"> D4((Y4))</span><br><span class="line"> D1---D2</span><br><span class="line"> D1---D3</span><br><span class="line"> D2---D4</span><br><span class="line"> D2---D3</span><br><span class="line"> D3---D4</span><br></pre></td></tr></table></figure>
<p>概率无向图模型的因子分解：将概率无向图模型的联合概率分布表示为其最大团上的随机变量的函数的乘积形式。</p>
<script type="math/tex; mode=display">
\begin{align}& \mathbf{P(Y)}=\frac{1}{Z}\prod_C{\varPsi_c(Y_c)} \\& Z = \sum_Y\prod_C{\varPsi_c(Y_c)}\end{align}</script><p>其中函数$\varPsi_c(Y_c)$称为势函数，一般要求是严格正的，通常定义为指数函数</p>
<script type="math/tex; mode=display">
\begin{align}\varPsi_c(Y_c) = \exp\{-E(Y_c)\}\end{align}</script><h2 id="条件随机场"><a href="#条件随机场" class="headerlink" title="条件随机场"></a>条件随机场</h2><p>条件随机场：给定随机变量$\mathbf{X}$条件下，随机变量$\mathbf{Y}$的马尔可夫随机场。</p>
<p>定义：条件随机场</p>
<p>设$\mathbf{X}$和$\mathbf{Y}$是随机变量，$\mathbf{P(Y|X)}$是在给定$\mathbf{X}$条件下$\mathbf{Y}$的条件概率分布。若随机变量$\mathbf{Y}$构成一个由无向图$\mathbf{G=(V,E)}$表示的马尔可夫随机场，即</p>
<script type="math/tex; mode=display">
\begin{align}P(Y_v|X,Y_w,w\neq v) = P(Y_v|X,Y_w,w \sim v)\end{align}</script><p>对任意结点$v$成立，则条件概率分布$\mathbf{P(Y|X)}$为条件随机场。其中，$w \sim v$表示在图中和结点$v$连接的所有结点$w$,$w \neq v$表示结点$v$之外的所有节点。$\mathbf{Y_v,Y_u,Y_w}$为结点$\mathbf{v,u,w}$对应的随机变量。</p>
<p>定义中没有假设，$\mathbf{X}$和$\mathbf{Y}$具有相同的结构。现实中，一般假设它们图结构相同。</p>
<p>定义：线性链条件随机场</p>
<p>设$\mathbf{X=(X_1,X_2,\cdots,X_n)}，\mathbf{Y=(Y_1,Y_2,\cdots,Y_n)}$均为线性链表示的随机变量序列，若在给定随机变量序列$\mathbf{X}$的条件下，随机变量序列$\mathbf{Y}$的条件概率分布构成条件随机场。</p>
<script type="math/tex; mode=display">
\begin{align}& P(Y_i|X,Y_1,\cdots,Y_{i-1},Y_{i+1},\cdots,Y_n) = P(Y_i|X,Y_{i-1},Y_{i+1}) \; i=1,2,\cdots,n\end{align}</script><p>在标注问题中，$\mathbf X$表示输入观测序列，$\mathbf Y$表示对应的输出标记序列或状态序列。</p>
<h3 id="CRF的参数化形式"><a href="#CRF的参数化形式" class="headerlink" title="CRF的参数化形式"></a>CRF的参数化形式</h3><p>线性链CRF的参数化形式，设$\mathbf{P(Y|X)}$为线性链CRF，则在随机变量$\mathbf  X$取值为$\mathbf x$的条件下，随机变量$\mathbf Y$取值为$\mathbf y$的条件概率具有以下形式：</p>
<script type="math/tex; mode=display">
\begin{align}& P(\mathbf y|\mathbf x) = \frac{1}{Z(\mathbf x)} \exp(\sum_{i,k}\lambda_kt_k(\mathbf y_{i-1},\mathbf y_i,\mathbf x,i)+\sum_{i,l}\mu_ls_l(\mathbf y_i,\mathbf x,i)) \\& Z(\mathbf x) = \sum_{\mathbf y}\exp(\sum_{i,k}\lambda_kt_k(\mathbf y_{i-1},\mathbf y_i,\mathbf x,i)+\sum_{i,l}\mu_ls_l(\mathbf y_i,\mathbf x,i)) \end{align}</script><p>其中，$t_k和s_l$是特征函数，$\lambda_k和\mu_l$是对应的权值，$Z(\mathbf x)$是规范化因子。</p>
<h3 id="CRF的简化形式"><a href="#CRF的简化形式" class="headerlink" title="CRF的简化形式"></a>CRF的简化形式</h3><p>将局部特征函数转化为全局特征函数，CRF则可以写成权值向量和特征向量的内积形式。</p>
<p>将转移特征和状态特征机器权值用统一的符号表示。</p>
<p>设有$K_1$个转移特征，$K_2$个状态特征，$K=K_1+K_2$</p>
<script type="math/tex; mode=display">
f_k(\mathbf y_{i-1},\mathbf y_i,\mathbf x,i) = \begin{cases}t_k(\mathbf y_{i-1},\mathbf y_i,\mathbf x,i) \quad k=1,2,\cdots,K_1\\s_l(\mathbf y_i,\mathbf x,i) \quad k=K_1+l,l=1,2,\cdots,K_2\end{cases}</script><p>然后对转移和状态特征在各个位置i求和，记作：</p>
<script type="math/tex; mode=display">
f_k(\mathbf y,\mathbf x)=\sum_{i=1}^n f_k(\mathbf y_{i-1},\mathbf y_i,\mathbf x,i) k=1,2,\cdots,K</script><p>用$\mathbf w_k$表示特征$f_k(\mathbf y,\mathbf x)$的权值，即</p>
<script type="math/tex; mode=display">
\mathbf w_k = \begin{cases}\lambda_k, \quad k=1,2,\cdots,K_1 \\\mu_l, \quad k=K_1+l,l=1,2,\cdots,K_2\end{cases}</script><p>因此，条件随机场可以表示为：</p>
<script type="math/tex; mode=display">
\begin{align}& P(\mathbf y|\mathbf x)= \frac{1}{Z(\mathbf x)}\exp \sum_{k=1}^K\mathbf w_k f_k(\mathbf y,\mathbf x) \\& Z(x) = \sum_{\mathbf y}\exp\sum_{k=1}^K\mathbf w_k f_k(\mathbf y,\mathbf x)\end{align}</script><p>若$\mathbf w$表示权值向量，$F(\mathbf y,\mathbf x)$表示全局特征向量：</p>
<script type="math/tex; mode=display">
\begin{align}& \mathbf w = (w_1,w_2,\cdots,w_k)^T \\& F(\mathbf y,\mathbf x) = (f_1(\mathbf y,\mathbf x),f_2(\mathbf y,\mathbf x),\cdots,f_K(\mathbf y,\mathbf x),)^T\end{align}</script><p>则CRF可以写成内积的形式：</p>
<script type="math/tex; mode=display">
\begin{align}& P(\mathbf y|\mathbf x)= \frac{\exp (\mathbf w \cdot F(\mathbf y,\mathbf x))}{Z(\mathbf x)} \\& Z(x) = \sum_{\mathbf y}\exp (\mathbf w \cdot F(\mathbf y,\mathbf x))\end{align}</script><h3 id="CRF的矩阵形式-（略）"><a href="#CRF的矩阵形式-（略）" class="headerlink" title="CRF的矩阵形式 （略）"></a>CRF的矩阵形式 （略）</h3><h2 id="CRF的概率计算问题"><a href="#CRF的概率计算问题" class="headerlink" title="CRF的概率计算问题"></a>CRF的概率计算问题</h2><p>给定CRF $\mathbf{P(Y|X)}$，输入序列$\mathbf x$和输出序列$\mathbf y$，计算条件概率$\mathbf{P(Y<em>i=y_i|x),P(Y</em>{i-1}=y_{i-1},Y_i=y_i|x)}$以及相应的数学期望的问题。</p>
<h3 id="前向-后向算法"><a href="#前向-后向算法" class="headerlink" title="前向-后向算法"></a>前向-后向算法</h3><p>像HMM一样，递归的计算以上概率及其期望值。</p>
<p>对于每个指标$i=0,1,\cdots,n+1$，定义前向向量$\alpha_i(\mathbf x)$:</p>
<script type="math/tex; mode=display">
\alpha_0(y|x)=\begin{cases}1,\quad y=start \\0,\quad other\end{cases}</script><p>递推公式为</p>
<script type="math/tex; mode=display">
\alpha_i^T(y_i|x)=\alpha_{i-1}^T(y_{i-1}|x)M_i(y_{i-1},y_i|x), \quad i=1,2,\cdots,n+1</script>
      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/04/GNN%E6%A8%A1%E5%9E%8B/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/04/GNN%E6%A8%A1%E5%9E%8B/" class="post-title-link" itemprop="url">GNN模型</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-04 15:39:27" itemprop="dateCreated datePublished" datetime="2020-05-04T15:39:27+08:00">2020-05-04</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-05 10:18:59" itemprop="dateModified" datetime="2020-05-05T10:18:59+08:00">2020-05-05</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%B7%B1%E5%BA%A6%E5%AD%A6%E4%B9%A0/" itemprop="url" rel="index"><span itemprop="name">深度学习</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/04/GNN%E6%A8%A1%E5%9E%8B/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/04/GNN%E6%A8%A1%E5%9E%8B/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="GNN-模型"><a href="#GNN-模型" class="headerlink" title="GNN 模型"></a>GNN 模型</h1><blockquote>
<p>GNN原始模型及其变种</p>
</blockquote>
<p>GNN的目标是学习一个状态嵌入$\mathbf{h}_v \in \mathbb{R}^s$，它包含每个节点相邻的信息，这个状态嵌入是节点v的s维度的向量表示，能够用来产生一个输出$\mathbf{o}_v$，这个输出可以是节点标签。$f$是一个参数化的函数，也叫做 $local\;transition\;function$，这个函数被所有节点共享，根据输入的相邻信息来更新节点状态。$g$是$local\;output\;function$，用来描述如何产生输出。</p>
<script type="math/tex; mode=display">
\begin{align}
& \mathbf{h}_v = f(\mathbf{x}_v,\mathbf{x}_{co[v]},\mathbf{h}_{ne[v]},\mathbf{x}_{ne[v]}) \\
& \mathbf{o}_v=g(\mathbf{h}_v,\mathbf{x}_v)
\end{align}</script><p>其中$\mathbf{x}<em>v,\mathbf{x}</em>{co[v]},\mathbf{h}<em>{ne[v]},\mathbf{x}</em>{ne[v]}$分别是节点$v$的特征、它的边的特征、$v$的邻居节点的状态和特征。</p>
<p>通过堆叠所有的状态、输出、特征和节点特征来构造$\mathbf{H},\mathbf{O},\mathbf{X},\mathbf{X}_N$。这样可以得到一个紧密的格式</p>
<script type="math/tex; mode=display">
\begin{align}
& \mathbf{H} = F(\mathbf{H},\mathbf{X}) \\
& \mathbf{O} = G(\mathbf{H},\mathbf{X}_N)
\end{align}</script><p>其中$F$是$global\;transition\;function$，$G$是$global\;output\;function$，它们将图中所有节点上的$f$和$g$叠加而成。</p>
<p>GNN使用下面经典的迭代格式来计算状态</p>
<script type="math/tex; mode=display">
\begin{align}
& \mathbf{H}^{t+1} = F(\mathbf{H}^t,\mathbf{X})
\end{align}</script><p>$\mathbf{H}^t$记作第t次迭代的$\mathbf{H}$。</p>
<p>$f$和$g$的计算可以描述为前向神经网络。</p>
<p>当在监督学习中，有着明确的目标值，loss可以被定义为如下：</p>
<script type="math/tex; mode=display">
\begin{align}
& loss = \sum_{i=1}^p (\mathbf{t}_i-\mathbf{o}_i)
\end{align}</script><p>其中p是被监督的节点的数量，学习算法是基于梯度下降的策略的。</p>
<p>限制</p>
<ol>
<li>对固定点来迭代的更新节点的隐藏状态是无效的，如果放宽固定点的假设，可以设计一个多层的GNN来获得节点和相邻的稳定表示。</li>
<li>GNN在迭代中使用一样的参数，然而大多数流行的神经网络在不同的层使用不同的参数，这被认为是一种分层特征提取方法。同时，节点隐藏状态的更新是一种顺序过程。</li>
<li>在原始的GNN中，边的一些信息无法被有效的建模。比如知识图谱中的边有关系的类型和传播的信息。</li>
<li>如何学习边的隐藏状态也是一个问题。</li>
<li>如果关注节点的表示而不是图的表示，使用固定点是不合适的，因为固定点的表示值更加平滑，只有较少的信息来区分每个节点。</li>
</ol>
<h2 id="Graph-Types"><a href="#Graph-Types" class="headerlink" title="Graph Types"></a>Graph Types</h2><blockquote>
<p>原始的GNN中，输入的图具有标签信息的节点和没有方向的边组成，这是最简单的图的格式。</p>
</blockquote>
<h3 id="Directed-Graphs"><a href="#Directed-Graphs" class="headerlink" title="Directed Graphs"></a>Directed Graphs</h3><p>无向的边可以额被看成两个有向的边，表示了两个即结点之间的联系。然而，有向边比无向边具有更多的信息。例如，在知识图谱中，有向边的起点是头节点，结尾是尾节点，表示信息的传播过程是有向的。</p>
<p>DGP使用两种权值矩阵$\mathbf{W}_p,\mathbf{W}_c$来表示更详细的结构信息。传播规则能够采用如下的方式表示：</p>
<script type="math/tex; mode=display">
\begin{align}
& \mathbf{H} = \sigma(\mathbf{D}_p^{-1}\mathbf{A}_P\sigma(\mathbf{D}_c^{-1}\mathbf{A}_c\mathbf{H}^{t-1}\mathbf{W}_c)\mathbf{W}_p)
\end{align}</script><p>其中$\mathbf{D}_p^{-1}\mathbf{A}_P,\mathbf{D}_c^{-1}\mathbf{A}_c$分别是头节点和尾节点的标准化的邻接矩阵。</p>
<h3 id="Heterogeneous-Graphs"><a href="#Heterogeneous-Graphs" class="headerlink" title="Heterogeneous Graphs"></a>Heterogeneous Graphs</h3><p>异质图，有多种类型节点。</p>
<p>处理异质图最简单的方式是将每个节点的类型转为 one-hot特征向量，将它和原始的特征合在一起。GraphInception将元路径的概念引入了异构图的传播中。借助元路径，我们可以根据节点的类型和距离对邻居进行分组。</p>
<h3 id="Graph-with-Edge-Information"><a href="#Graph-with-Edge-Information" class="headerlink" title="Graph with Edge Information"></a>Graph with Edge Information</h3><p>每条边有额外的信息，比如权重和边的类型，主要有两种方法来处理这类的图</p>
<ol>
<li><p>可以将图转换成一个二分图，图中原始的边变成节点，一条原始的边被分成两个新的边，这表示在新的边节点和原来的开始／结束节点有两条新的边。G2S中的encoder对邻居使用了下面的聚合函数：</p>
<script type="math/tex; mode=display">
\begin{align}
\mathbf{h}_v^t = \rho(\frac{1}{|\mathcal{N}_v|}\sum_{u\in \mathcal{N}_v } \mathbf{W}_r(\mathbf{r}_v^t\odot\mathbf{h}_u^{t-1})+\mathbf{b}_r)
\end{align}</script><p>其中$\mathbf{W}_r，\mathbf{b}_r$是不同类型的边的传播参数。</p>
</li>
<li><p>对不同类型节点上的传播使用不同的权值矩阵。当关系的数目非常大的时候，R-GCN介绍了两种正则化来减少对关系建模的参数的数量，这两种分别是：$basis/block-diagonal-decomposition$（对角分解和块对角分解）。</p>
<p>使用基础的对角分解，每个$\mathbf{W}_r$被定义成如下：</p>
<script type="math/tex; mode=display">
\begin{align}
& \mathbf{W}_r = \sum_1^{B} a_{rb}\mathbf{V}_b
\end{align}</script><p>其中，每个$\mathbf{W}<em>r$都是系数为$a</em>{rb}$的基础变换$\mathbf{V}<em>b \in \mathbb{R}^{d</em>{in} \times d_{out}} $的线性组合。</p>
<p>对于块对角分解，R-GCN定义$\mathbf{W}_r$为一系列低维矩阵的和，这就比基础分解需要更多的参数。</p>
</li>
</ol>
<h3 id="Dynamic-Graphs"><a href="#Dynamic-Graphs" class="headerlink" title="Dynamic Graphs"></a>Dynamic Graphs</h3><p>动态图有着静态的图结构和动态的输入信息。</p>
<p>为了捕捉信息的种类，DCRNN和STGCN首先通过GNN来手机空间信息，然后，将得到的输出输入到序列模型中，比如在seq-2-seq模型或者CNNs。不同的是，Structural-RNN 和ST-GCN同时收集空间信息和时间信息。它们使用时间上的连接来扩展静态图，因此可以用传统的GNNs。</p>
<p><img src="/home/dongxian/github.io/source/images/GNN/GraphType.png" alt="GraphType"></p>
<p><img src="/home/dongxian/github.io/source/images/GNN/TrainingMethods.png" alt="TrainingMethods"></p>
<p><img src="/home/dongxian/github.io/source/images/GNN/PropagationSteps.png" alt="PropagationSteps"></p>
<p><a href="https://arxiv.org/abs/1812.08434" target="_blank" rel="noopener">https://arxiv.org/abs/1812.08434</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/05/02/NLP%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/05/02/NLP%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84/" class="post-title-link" itemprop="url">NLP模型结构</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-05-02 21:01:53" itemprop="dateCreated datePublished" datetime="2020-05-02T21:01:53+08:00">2020-05-02</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-05-03 08:39:55" itemprop="dateModified" datetime="2020-05-03T08:39:55+08:00">2020-05-03</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/NLP/" itemprop="url" rel="index"><span itemprop="name">NLP</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/05/02/NLP%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/05/02/NLP%E6%A8%A1%E5%9E%8B%E7%BB%93%E6%9E%84/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NLP模型结构"><a href="#NLP模型结构" class="headerlink" title="NLP模型结构"></a>NLP模型结构</h1><h2 id="TextCNN"><a href="#TextCNN" class="headerlink" title="TextCNN"></a>TextCNN</h2><p><a href="https://www.bbsmax.com/A/kjdwWe06dN/" target="_blank" rel="noopener">https://www.bbsmax.com/A/kjdwWe06dN/</a></p>
<p><img src="/home/dongxian/github.io/source/images/nlp/TextCNN.jpg.png" alt="TextCNN.jpg"></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/25/%E7%BA%A2%E9%BB%91%E6%A0%91/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/25/%E7%BA%A2%E9%BB%91%E6%A0%91/" class="post-title-link" itemprop="url">红黑树</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-25 09:22:01" itemprop="dateCreated datePublished" datetime="2020-04-25T09:22:01+08:00">2020-04-25</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-26 10:24:12" itemprop="dateModified" datetime="2020-04-26T10:24:12+08:00">2020-04-26</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84%E5%92%8C%E7%AE%97%E6%B3%95/" itemprop="url" rel="index"><span itemprop="name">数据结构和算法</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/04/25/%E7%BA%A2%E9%BB%91%E6%A0%91/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/25/%E7%BA%A2%E9%BB%91%E6%A0%91/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="红黑树"><a href="#红黑树" class="headerlink" title="红黑树"></a>红黑树</h1><blockquote>
<p>R-B Tree，全称是Red-Black Tree，又称为“红黑树”，它一种特殊的二叉查找树。红黑树的每个节点上都有存储位表示节点的颜色，可以是红(Red)或黑(Black)。</p>
</blockquote>
<p>特点</p>
<ol>
<li>每个节点是黑色或者红色。</li>
<li>根节点是黑色。</li>
<li>每个叶子节点(NIL)是黑色。注：这里的叶子节点，指的是看空（NULL or NIL）的叶子节点</li>
<li>如果一个节点是红色的，则它的子节点必须是黑色。</li>
<li>从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑色节点。</li>
</ol>
<ul>
<li>特点3中的叶子节点，只能为空的节点。</li>
<li>特点5，确保没有一条路径会比其他路径长出两倍。因此，红黑树是相对接近平衡的二叉树。</li>
</ul>
<h2 id="红黑树的应用"><a href="#红黑树的应用" class="headerlink" title="红黑树的应用"></a>红黑树的应用</h2><p>主要用于存储有序的数据，它的时间复杂度是$O(\log n)$，效率非常高。</p>
<p>例如：Java集合中的<code>TreeSet</code>和<code>TreeMap</code>，C++ <code>STL</code> 中的<code>set</code>,<code>map</code>。以及Linux虚拟内存的管理。</p>
<h2 id="红黑树的时间复杂度和相关证明"><a href="#红黑树的时间复杂度和相关证明" class="headerlink" title="红黑树的时间复杂度和相关证明"></a>红黑树的时间复杂度和相关证明</h2><p><strong>红黑树的时间复杂度为：$O\log n$</strong></p>
<p>使用数学归纳法进行证明：</p>
<p>定理：一棵含有n个节点的红黑树的高度至多为$2\log(n+1)$</p>
<p>证明：</p>
<h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p><a href="https://www.cnblogs.com/skywang12345/p/3245399.html" target="_blank" rel="noopener">https://www.cnblogs.com/skywang12345/p/3245399.html</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/16/ElasticSearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/16/ElasticSearch/" class="post-title-link" itemprop="url">ElasticSearch</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-16 11:55:54 / 修改时间：15:57:39" itemprop="dateCreated datePublished" datetime="2020-04-16T11:55:54+08:00">2020-04-16</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E5%B7%A5%E5%85%B7/" itemprop="url" rel="index"><span itemprop="name">工具</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/04/16/ElasticSearch/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/16/ElasticSearch/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="ElasticSearch-基础实践-Quick-Start"><a href="#ElasticSearch-基础实践-Quick-Start" class="headerlink" title="ElasticSearch 基础实践 Quick Start"></a>ElasticSearch 基础实践 Quick Start</h1><h2 id="基本概念"><a href="#基本概念" class="headerlink" title="基本概念"></a>基本概念</h2><ol>
<li>Neal Realtime(NRT)：接近实时的</li>
<li>Cluster：集群是一个或多个节点（服务器）的集合，它们一起保存数据，并且提供跨节点的联合索引和搜索功能。一个集群的名字需要唯一标识。</li>
<li>Node：节点是一个服务器，是集群的一部分，存储数据，参与集群的索引和搜索。同样需要唯一名称标识。通常是启动时候随机的UUID。</li>
<li>Index：索引是具有某些相似特征文档的集合。比如客户数据的索引，产品目录的索引。索引由一个名称标识，该名称用于在对其中的文档执行索引、搜索、更新和删除操作时引用索引。</li>
<li>Type (Deprecated)</li>
<li>Document：文档是可以被索引的基本单位。在一个索引 / 类型中，您可以存储任意多的文档。</li>
<li>Shards &amp; Replicas：索引可能存储大量数据，这些数据可能超过节点的硬件限制。为了解决这个问题，提供了将索引细分为多个部分的功能 Shards碎片。创建索引的时候，可以定义所需碎片数目。</li>
</ol>
<h2 id="搜索你的集群"><a href="#搜索你的集群" class="headerlink" title="搜索你的集群"></a>搜索你的集群</h2><h3 id="The-REST-API"><a href="#The-REST-API" class="headerlink" title="The REST API"></a>The REST API</h3><p>假设现在一起启动并运行了节点和集群。ES提供了强大的REST API。</p>
<ul>
<li>检查cluster、node、index的状态和统计信息</li>
<li>管理cluster、node、index data和metadata</li>
<li>对索引执行CRUD和搜索操作</li>
<li>执行高级搜索操作，比如分页，排序，过滤，聚合等等。</li>
</ul>
<h3 id="Cluster-Health"><a href="#Cluster-Health" class="headerlink" title="Cluster Health"></a>Cluster Health</h3><p>检查cluster的health</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/_cat/health?v&amp;pretty"</span></span></span><br><span class="line">epoch      timestamp cluster       status node.total node.data shards pri relo init unassign pending_tasks max_task_wait_time active_shards_percent</span><br><span class="line">1587010145 04:09:05  elasticsearch green           1         1      0   0    0    0        0             0                  -                100.0%</span><br></pre></td></tr></table></figure>
<p>可以看到名为elasticsearch的集群的状态是green</p>
<ul>
<li>Green 一切都好</li>
<li>Yellow 所有的数据是可获得的，但是一些分片还没分配</li>
<li>Read 因为某些原因，无法获得数据。</li>
</ul>
<p>查看集群中的节点列表</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/_cat/nodes?v&amp;pretty"</span></span></span><br><span class="line">ip        heap.percent ram.percent cpu load_1m load_5m load_15m node.role master name</span><br><span class="line">127.0.0.1           11          96  14    0.87    0.88     0.97 dilm      *      dongxian-manjaro</span><br></pre></td></tr></table></figure>
<h3 id="列出所有索引"><a href="#列出所有索引" class="headerlink" title="列出所有索引"></a>列出所有索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/_cat/indices?v&amp;pretty"</span></span></span><br><span class="line">health status index uuid pri rep docs.count docs.deleted store.size pri.store.size</span><br></pre></td></tr></table></figure>
<h3 id="创建一个索引"><a href="#创建一个索引" class="headerlink" title="创建一个索引"></a>创建一个索引</h3><p>现在创建一个名为customer的索引，然后列出来</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X PUT <span class="string">"localhost:9200/customer?pretty&amp;pretty"</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "acknowledged" : true,</span><br><span class="line">  "shards_acknowledged" : true,</span><br><span class="line">  "index" : "customer"</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/_cat/indices?v&amp;pretty"</span></span></span><br><span class="line">health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">yellow open   customer WYuBXNDZSxWkNfDZ4ArKLA   1   1          0            0       230b           230b</span><br></pre></td></tr></table></figure>
<p>第二个命令的结果告诉我们，现在有一个名为customer的索引，有1个主碎片和1个副本，其中包含0个文档。</p>
<p>由于当前只有一个节点在运行，状态为Yellow，因为没有办法分配副本。</p>
<h3 id="索引和查询文档"><a href="#索引和查询文档" class="headerlink" title="索引和查询文档"></a>索引和查询文档</h3><p>让我们输入一些东西到customer index中，我们使用ID 1来标识文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X PUT <span class="string">"localhost:9200/customer/doc/1?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "name": "John Doe"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 1,</span><br><span class="line">  "result" : "created",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 0,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>获取我们刚刚增加到索引的文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X GET <span class="string">"localhost:9200/customer/doc/1?pretty&amp;pretty"</span></span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 1,</span><br><span class="line">  "_seq_no" : 0,</span><br><span class="line">  "_primary_term" : 1,</span><br><span class="line">  "found" : true,</span><br><span class="line">  "_source" : &#123;</span><br><span class="line">    "name" : "John Doe"</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>返回的的信息中</p>
<ul>
<li>fount：表示我们找到一个ID 为 1的文档</li>
<li>_source：返回我们先前插入的整个JSON文档</li>
</ul>
<h3 id="删除一个索引"><a href="#删除一个索引" class="headerlink" title="删除一个索引"></a>删除一个索引</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X DELETE <span class="string">"localhost:9200/customer?pretty&amp;pretty"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/_cat/indices?v&amp;pretty"</span></span></span><br><span class="line">health status index uuid pri rep docs.count docs.deleted store.size pri.store.size</span><br></pre></td></tr></table></figure>
<p>通过上面我们可以发现，REST access pattern</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;REST Verb&gt; &#x2F;&lt;Index&gt;&#x2F;&lt;Type&gt;&#x2F;&lt;ID&gt;</span><br></pre></td></tr></table></figure>
<h2 id="修改数据"><a href="#修改数据" class="headerlink" title="修改数据"></a>修改数据</h2><p>插入和替换文档</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X PUT <span class="string">"localhost:9200/customer/doc/1?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "name": "John Doe"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 1,</span><br><span class="line">  "result" : "created",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 0,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">$</span><span class="bash"> curl -X PUT <span class="string">"localhost:9200/customer/doc/1?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "name": "Jane Doe"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 2,</span><br><span class="line">  "result" : "updated",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 1,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的操作，修改ID 为1的文档的name。如果我们使用不同的ID，将会产生新的文档，现有的文档不会变换。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X PUT <span class="string">"localhost:9200/customer/doc/2?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "name": "Jane Doe"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "2",</span><br><span class="line">  "_version" : 1,</span><br><span class="line">  "result" : "created",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 2,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>当indexing的时候，ID是可选的，如果显式知名，ES会自动生成一个随机ID。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X POST <span class="string">"localhost:9200/customer/doc?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "name": "Jane Doe"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "MhxFgXEBHBe5IUAf-8U3",</span><br><span class="line">  "_version" : 1,</span><br><span class="line">  "result" : "created",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 3,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意，这边使用的POST替换PUT，因为没有指明ID。</p>
<h3 id="更新文档"><a href="#更新文档" class="headerlink" title="更新文档"></a>更新文档</h3><p>除了索引和替换文档，我们还可以更新文档。每当我们做一个更新，ES删除旧的文档，然后索引一个新的文档。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X POST <span class="string">"localhost:9200/customer/doc/1/_update?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "doc": &#123; "name": "Jane Doe" &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 2,</span><br><span class="line">  "result" : "noop",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 0,</span><br><span class="line">    "successful" : 0,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 1,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>更新文档，并且增加字段</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X POST <span class="string">"localhost:9200/customer/doc/1/_update?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "doc": &#123; "name": "Jane Doe", "age": 20 &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 3,</span><br><span class="line">  "result" : "updated",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 4,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>也可以使用脚本更新文档，使用脚本将age增加5：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X POST <span class="string">"localhost:9200/customer/doc/1/_update?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "script" : "ctx._source.age += 5"</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "1",</span><br><span class="line">  "_version" : 4,</span><br><span class="line">  "result" : "updated",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 5,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>ES提供了在查询条件下更新多个文档的能力</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/docs-update-by-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.0/docs-update-by-query.html</a></p>
<h3 id="删除文档"><a href="#删除文档" class="headerlink" title="删除文档"></a>删除文档</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X DELETE <span class="string">"localhost:9200/customer/doc/2?pretty&amp;pretty"</span></span></span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "_index" : "customer",</span><br><span class="line">  "_type" : "doc",</span><br><span class="line">  "_id" : "2",</span><br><span class="line">  "_version" : 2,</span><br><span class="line">  "result" : "deleted",</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 2,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "_seq_no" : 6,</span><br><span class="line">  "_primary_term" : 1</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/docs-delete-by-query.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.0/docs-delete-by-query.html</a></p>
<h3 id="批处理"><a href="#批处理" class="headerlink" title="批处理"></a>批处理</h3><p>除了索引、更新、删除单个文档外，ES提供了使用批处理上面的能力。</p>
<p>下面在批量操作中索引两个文档：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X POST <span class="string">"localhost:9200/customer/doc/_bulk?pretty&amp;pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;"index":&#123;"_id":"1"&#125;&#125;</span><br><span class="line">&#123;"name": "John Doe" &#125;</span><br><span class="line">&#123;"index":&#123;"_id":"2"&#125;&#125;</span><br><span class="line">&#123;"name": "Jane Doe" &#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>更新第一个文档，删除第二个文档：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X POST "localhost:9200/customer/doc/_bulk?pretty&amp;pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;"update":&#123;"_id":"1"&#125;&#125;</span><br><span class="line">&#123;"doc": &#123; "name": "John Doe becomes Jane Doe" &#125; &#125;</span><br><span class="line">&#123;"delete":&#123;"_id":"2"&#125;&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>批处理API不会因为单个操作失败而失败，如果单个操作因为某种原因失败，它将会继续后面的其他操作。返回时，为每一个操作提供一个状态，表示是否操作失败。</p>
<h2 id="探索数据"><a href="#探索数据" class="headerlink" title="探索数据"></a>探索数据</h2><p>样本数据集：</p>
<p>现在我们已经了解了一些基本知识，接下来让我们尝试使用一个更加真实的数据集。 我准备了一个虚构的客户银行账户信息 JSON 文档样本。 每个文档都有以下模式:</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    <span class="attr">"account_number"</span>: <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"balance"</span>: <span class="number">16623</span>,</span><br><span class="line">    <span class="attr">"firstname"</span>: <span class="string">"Bradshaw"</span>,</span><br><span class="line">    <span class="attr">"lastname"</span>: <span class="string">"Mckenzie"</span>,</span><br><span class="line">    <span class="attr">"age"</span>: <span class="number">29</span>,</span><br><span class="line">    <span class="attr">"gender"</span>: <span class="string">"F"</span>,</span><br><span class="line">    <span class="attr">"address"</span>: <span class="string">"244 Columbus Place"</span>,</span><br><span class="line">    <span class="attr">"employer"</span>: <span class="string">"Euron"</span>,</span><br><span class="line">    <span class="attr">"email"</span>: <span class="string">"bradshawmckenzie@euron.com"</span>,</span><br><span class="line">    <span class="attr">"city"</span>: <span class="string">"Hobucken"</span>,</span><br><span class="line">    <span class="attr">"state"</span>: <span class="string">"CO"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>这些数据都是使用  <a href="http://www.json-generator.com/" target="_blank" rel="noopener">http://www.json-generator.com/</a>   生成的，因为是随机生成的，所以忽略数据的实际值和含义。</p>
<p>加载样本数据集</p>
<p><a href="https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json?raw=true" target="_blank" rel="noopener">https://github.com/elastic/elasticsearch/blob/master/docs/src/test/resources/accounts.json?raw=true</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -H <span class="string">"Content-Type: application/json"</span> -XPOST <span class="string">'localhost:9200/bank/account/_bulk?pretty&amp;refresh'</span> --data-binary <span class="string">"@accounts.json"</span></span></span><br><span class="line"><span class="meta">$</span><span class="bash">curl <span class="string">'localhost:9200/_cat/indices?v'</span></span></span><br><span class="line"></span><br><span class="line">health status index    uuid                   pri rep docs.count docs.deleted store.size pri.store.size</span><br><span class="line">yellow open   bank     3O23VfKaRse97IfFCLDPyA   1   1       1000            0      414kb          414kb</span><br><span class="line">yellow open   customer pcIogOc6SjyqyPlSh0vmzw   1   1          3            0        4kb            4kb</span><br></pre></td></tr></table></figure>
<p>表明已经成功将1000份文件批量索引到银行索引中下的账户下</p>
<h3 id="搜索API"><a href="#搜索API" class="headerlink" title="搜索API"></a>搜索API</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?q=*&amp;sort=account_number:asc&amp;pretty&amp;pretty"</span><br></pre></td></tr></table></figure>
<ul>
<li><code>q*</code>：表示ES匹配索引中所有文档</li>
<li><code>sort=account_number:asc</code>：表示使用每个文档的acount_number字段进行升序排序</li>
<li><code>pretty</code>：表示返回格式化的JSON</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"took"</span> : <span class="number">63</span>,</span><br><span class="line">  <span class="attr">"timed_out"</span> : <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">"_shards"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"successful"</span> : <span class="number">5</span>,</span><br><span class="line">    <span class="attr">"skipped"</span> : <span class="number">0</span>,</span><br><span class="line">    <span class="attr">"failed"</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">"hits"</span> : &#123;</span><br><span class="line">    <span class="attr">"total"</span> : <span class="number">1000</span>,</span><br><span class="line">    <span class="attr">"max_score"</span> : <span class="literal">null</span>,</span><br><span class="line">    <span class="attr">"hits"</span> : [ &#123;</span><br><span class="line">      <span class="attr">"_index"</span> : <span class="string">"bank"</span>,</span><br><span class="line">      <span class="attr">"_type"</span> : <span class="string">"account"</span>,</span><br><span class="line">      <span class="attr">"_id"</span> : <span class="string">"0"</span>,</span><br><span class="line">      <span class="attr">"sort"</span>: [<span class="number">0</span>],</span><br><span class="line">      <span class="attr">"_score"</span> : <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"_source"</span> : &#123;<span class="attr">"account_number"</span>:<span class="number">0</span>,<span class="attr">"balance"</span>:<span class="number">16623</span>,<span class="attr">"firstname"</span>:<span class="string">"Bradshaw"</span>,<span class="attr">"lastname"</span>:<span class="string">"Mckenzie"</span>,<span class="attr">"age"</span>:<span class="number">29</span>,<span class="attr">"gender"</span>:<span class="string">"F"</span>,<span class="attr">"address"</span>:<span class="string">"244 Columbus Place"</span>,<span class="attr">"employer"</span>:<span class="string">"Euron"</span>,<span class="attr">"email"</span>:<span class="string">"bradshawmckenzie@euron.com"</span>,<span class="attr">"city"</span>:<span class="string">"Hobucken"</span>,<span class="attr">"state"</span>:<span class="string">"CO"</span>&#125;</span><br><span class="line">    &#125;, &#123;</span><br><span class="line">      <span class="attr">"_index"</span> : <span class="string">"bank"</span>,</span><br><span class="line">      <span class="attr">"_type"</span> : <span class="string">"account"</span>,</span><br><span class="line">      <span class="attr">"_id"</span> : <span class="string">"1"</span>,</span><br><span class="line">      <span class="attr">"sort"</span>: [<span class="number">1</span>],</span><br><span class="line">      <span class="attr">"_score"</span> : <span class="literal">null</span>,</span><br><span class="line">      <span class="attr">"_source"</span> : &#123;<span class="attr">"account_number"</span>:<span class="number">1</span>,<span class="attr">"balance"</span>:<span class="number">39225</span>,<span class="attr">"firstname"</span>:<span class="string">"Amber"</span>,<span class="attr">"lastname"</span>:<span class="string">"Duke"</span>,<span class="attr">"age"</span>:<span class="number">32</span>,<span class="attr">"gender"</span>:<span class="string">"M"</span>,<span class="attr">"address"</span>:<span class="string">"880 Holmes Lane"</span>,<span class="attr">"employer"</span>:<span class="string">"Pyrami"</span>,<span class="attr">"email"</span>:<span class="string">"amberduke@pyrami.com"</span>,<span class="attr">"city"</span>:<span class="string">"Brogan"</span>,<span class="attr">"state"</span>:<span class="string">"IL"</span>&#125;</span><br><span class="line">    &#125;, ...</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>响应部分：</p>
<ul>
<li><code>took</code>：执行搜索的时间</li>
<li><code>timed_out</code>：告诉我们搜索是否超时</li>
<li><code>_shards</code>：告诉我们搜索了多少碎片，以及成功 / 失败的搜索碎片的数量</li>
<li><code>hits</code>：搜索结果</li>
<li><code>hits.total</code>：符合搜索约束的文档数量</li>
<li><code>hits.hits</code>：搜索结果的实际数组</li>
<li><code>hits.sort</code>：结果的排序key</li>
<li><code>hits._score</code>、<code>max_score</code></li>
</ul>
<p>下面是上面的替换方案</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">  "sort": [</span><br><span class="line">    &#123; "account_number": "asc" &#125;</span><br><span class="line">  ]</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>这边的区别是，没有在URI中传递参数，而是向API提供了JSON格式的查询请求体。</p>
<h3 id="Query-Language"><a href="#Query-Language" class="headerlink" title="Query Language"></a>Query Language</h3><p>ElasticSearch提供了JSON风格的查询语言</p>
<p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/query-dsl.html" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.0/query-dsl.html</a></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p><code>query</code>部分告诉查询定义是什么，<code>match_all</code>只是搜索指定索引中的所有文档。</p>
<p>除此之外，我们烟叶可以传递其他参数来影响搜索结果，在例子中使用了<code>sort</code>，这边我们可以使用<code>size</code></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> curl -X GET <span class="string">"localhost:9200/bank/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">  "size": 1</span><br><span class="line">&#125;</span><br><span class="line">'</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line">  "took" : 6,</span><br><span class="line">  "timed_out" : false,</span><br><span class="line">  "_shards" : &#123;</span><br><span class="line">    "total" : 1,</span><br><span class="line">    "successful" : 1,</span><br><span class="line">    "skipped" : 0,</span><br><span class="line">    "failed" : 0</span><br><span class="line">  &#125;,</span><br><span class="line">  "hits" : &#123;</span><br><span class="line">    "total" : &#123;</span><br><span class="line">      "value" : 1000,</span><br><span class="line">      "relation" : "eq"</span><br><span class="line">    &#125;,</span><br><span class="line">    "max_score" : 1.0,</span><br><span class="line">    "hits" : [</span><br><span class="line">      &#123;</span><br><span class="line">        "_index" : "bank",</span><br><span class="line">        "_type" : "account",</span><br><span class="line">        "_id" : "1",</span><br><span class="line">        "_score" : 1.0,</span><br><span class="line">        "_source" : &#123;</span><br><span class="line">          "account_number" : 1,</span><br><span class="line">          "balance" : 39225,</span><br><span class="line">          "firstname" : "Amber",</span><br><span class="line">          "lastname" : "Duke",</span><br><span class="line">          "age" : 32,</span><br><span class="line">          "gender" : "M",</span><br><span class="line">          "address" : "880 Holmes Lane",</span><br><span class="line">          "employer" : "Pyrami",</span><br><span class="line">          "email" : "amberduke@pyrami.com",</span><br><span class="line">          "city" : "Brogan",</span><br><span class="line">          "state" : "IL"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    ]</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果没有指定<code>size</code>，默认大小是10.</p>
<p>下面的例子匹配所有文档，返回从第十个开始的十个文档：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">  "from": 10,</span><br><span class="line">  "size": 10</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p><code>from</code>参数指定文档从那个index开始，<code>size</code>表示从from开始返回多少个文档。</p>
<p>下面匹配所有结果，按照账户余额降序排序：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">curl -X GET <span class="string">"localhost:9200/bank/_search?pretty"</span> -H <span class="string">'Content-Type: application/json'</span> -d<span class="string">'</span></span></span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">  "sort": &#123; "balance": &#123; "order": "desc" &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h3 id="执行搜索"><a href="#执行搜索" class="headerlink" title="执行搜索"></a>执行搜索</h3><p>上面已经介绍了基础的查询参数，下面更加深入Query DSL。</p>
<p>返回文档的field。默认整个JSON 文档作为搜索查询的部分返回。这和查询语句中的<code>_source</code>有关，我们可以指定一部分fields返回。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">  "_source": ["account_number", "balance"]</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>上面的例子通过<code>_source</code>减少了返回的属性。</p>
<p>和SQL中的<code>SELECT FROM</code>相似</p>
<p>使用<code>match</code>来查询：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match": &#123; "account_number": 20 &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>返回了所有的账户地址中包含’mill’</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match": &#123; "address": "mill" &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>返回账户地址中包含’mill’或’lane’</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match": &#123; "address": "mill lane" &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p><code>match</code>的变体<code>match_phrase</code>返回了地址包含”mill lane”的账户</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123; "match_phrase": &#123; "address": "mill lane" &#125; &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>下面是<code>bool</code> query，它能够将较小的查询组合成更大的查询</p>
<p>下面的例子组合两个<code>match</code>查询</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "bool": &#123;</span><br><span class="line">      "must": [</span><br><span class="line">        &#123; "match": &#123; "address": "mill" &#125; &#125;,</span><br><span class="line">        &#123; "match": &#123; "address": "lane" &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p><code>bool must</code>子句表示所有的查询必须是true。</p>
<p>同样也可以满足一个条件也返回：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "bool": &#123;</span><br><span class="line">      "should": [</span><br><span class="line">        &#123; "match": &#123; "address": "mill" &#125; &#125;,</span><br><span class="line">        &#123; "match": &#123; "address": "lane" &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>返回两个都不满足的结果：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "bool": &#123;</span><br><span class="line">      "must_not": [</span><br><span class="line">        &#123; "match": &#123; "address": "mill" &#125; &#125;,</span><br><span class="line">        &#123; "match": &#123; "address": "lane" &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>上面提到的<code>must should must_not</code>子句可以同时用在<code>bool</code> query中。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "bool": &#123;</span><br><span class="line">      "must": [</span><br><span class="line">        &#123; "match": &#123; "age": "40" &#125; &#125;</span><br><span class="line">      ],</span><br><span class="line">      "must_not": [</span><br><span class="line">        &#123; "match": &#123; "state": "ID" &#125; &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h3 id="执行过滤"><a href="#执行过滤" class="headerlink" title="执行过滤"></a>执行过滤</h3><p>前面的章节，我们忽略了一些小细节，文档的score(在搜索结果的<code>_score</code>字段)。它用于度量文档和查询语句的匹配程度。</p>
<p>但是查询不需要总是产生score。尤其是在用户filter文档时，ES会自动优化查询，避免计算无用的score。</p>
<p>上个章节的<code>bool</code>查询支持<code>filter</code>子句。</p>
<p>下面的例子上使用<code>bool</code> query返回所有余额在20000-30000的账户：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "query": &#123;</span><br><span class="line">    "bool": &#123;</span><br><span class="line">      "must": &#123; "match_all": &#123;&#125; &#125;,</span><br><span class="line">      "filter": &#123;</span><br><span class="line">        "range": &#123;</span><br><span class="line">          "balance": &#123;</span><br><span class="line">            "gte": 20000,</span><br><span class="line">            "lte": 30000</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h3 id="执行聚合"><a href="#执行聚合" class="headerlink" title="执行聚合"></a>执行聚合</h3><p>聚合提供了对数据进行分组和统计信息的能力</p>
<p>对所有账户进行分组</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "size": 0,</span><br><span class="line">  "aggs": &#123;</span><br><span class="line">    "group_by_state": &#123;</span><br><span class="line">      "terms": &#123;</span><br><span class="line">        "field": "state.keyword"</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p><code>size=0</code>为了不显示搜索，只希望看见聚合结构。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "size": 0,</span><br><span class="line">  "aggs": &#123;</span><br><span class="line">    "group_by_state": &#123;</span><br><span class="line">      "terms": &#123;</span><br><span class="line">        "field": "state.keyword"</span><br><span class="line">      &#125;,</span><br><span class="line">      "aggs": &#123;</span><br><span class="line">        "average_balance": &#123;</span><br><span class="line">          "avg": &#123;</span><br><span class="line">            "field": "balance"</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>在分组的基础上，计算每组的平均账户余额</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "size": 0,</span><br><span class="line">  "aggs": &#123;</span><br><span class="line">    "group_by_state": &#123;</span><br><span class="line">      "terms": &#123;</span><br><span class="line">        "field": "state.keyword",</span><br><span class="line">        "order": &#123;</span><br><span class="line">          "average_balance": "desc"</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">      "aggs": &#123;</span><br><span class="line">        "average_balance": &#123;</span><br><span class="line">          "avg": &#123;</span><br><span class="line">            "field": "balance"</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<p>在上面的基础上，对平均余额进行降序</p>
<p>按年龄段(20-29岁，30-39岁，40-49岁)分组，然后按性别分组，最后得到每个年龄段，每个性别的平均账户余额:</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET "localhost:9200/bank/_search?pretty" -H 'Content-Type: application/json' -d'</span><br><span class="line">&#123;</span><br><span class="line">  "size": 0,</span><br><span class="line">  "aggs": &#123;</span><br><span class="line">    "group_by_age": &#123;</span><br><span class="line">      "range": &#123;</span><br><span class="line">        "field": "age",</span><br><span class="line">        "ranges": [</span><br><span class="line">          &#123;</span><br><span class="line">            "from": 20,</span><br><span class="line">            "to": 30</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            "from": 30,</span><br><span class="line">            "to": 40</span><br><span class="line">          &#125;,</span><br><span class="line">          &#123;</span><br><span class="line">            "from": 40,</span><br><span class="line">            "to": 50</span><br><span class="line">          &#125;</span><br><span class="line">        ]</span><br><span class="line">      &#125;,</span><br><span class="line">      "aggs": &#123;</span><br><span class="line">        "group_by_gender": &#123;</span><br><span class="line">          "terms": &#123;</span><br><span class="line">            "field": "gender.keyword"</span><br><span class="line">          &#125;,</span><br><span class="line">          "aggs": &#123;</span><br><span class="line">            "average_balance": &#123;</span><br><span class="line">              "avg": &#123;</span><br><span class="line">                "field": "balance"</span><br><span class="line">              &#125;</span><br><span class="line">            &#125;</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line">'</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.elastic.co/guide/en/elasticsearch/reference/6.0/" target="_blank" rel="noopener">https://www.elastic.co/guide/en/elasticsearch/reference/6.0/</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/10/NestJs-Overview/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/10/NestJs-Overview/" class="post-title-link" itemprop="url">NestJs_Overview</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2020-04-10 14:28:39" itemprop="dateCreated datePublished" datetime="2020-04-10T14:28:39+08:00">2020-04-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2020-04-11 17:42:15" itemprop="dateModified" datetime="2020-04-11T17:42:15+08:00">2020-04-11</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E6%A1%86%E6%9E%B6/" itemprop="url" rel="index"><span itemprop="name">框架</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/04/10/NestJs-Overview/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/10/NestJs-Overview/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="NestJs"><a href="#NestJs" class="headerlink" title="NestJs"></a>NestJs</h1><h2 id="第一步"><a href="#第一步" class="headerlink" title="第一步"></a>第一步</h2><ol>
<li><p>编程语言：TypeScript &amp; Node.js，需要使用Babel compiler.</p>
</li>
<li><p>前提条件：Node.js(&gt;=10.13.0) 被安装</p>
</li>
<li><p>设置</p>
<p>使用Nest CLI 来设置一个新项目。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">npm i -g @nestjs/cli</span></span><br><span class="line"><span class="meta">$</span><span class="bash">nest new project-name</span></span><br></pre></td></tr></table></figure>
<p>将会创建项目目录，node模块和一些其他的模板文件被安装，<code>src/</code>目录将被创建并创建核心文件</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">src</span><br><span class="line">├── app.controller.spec.ts</span><br><span class="line">├── app.controller.ts</span><br><span class="line">├── app.module.ts</span><br><span class="line">├── app.service.ts</span><br><span class="line">└── main.ts</span><br></pre></td></tr></table></figure>
<ul>
<li><code>app.controller.ts</code>：单个路由的基础控制器例子</li>
<li><code>app.module.ts</code>：应用的root module</li>
<li><code>main.ts</code>：应用的入口文件，使用核心函数<code>NestFactory</code>创建一个Nest Application实例。</li>
</ul>
<p><code>main.ts</code>包含一个启动我们的应用的异步函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; NestFactory &#125; <span class="keyword">from</span> <span class="string">'@nestjs/core'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; AppModule &#125; <span class="keyword">from</span> <span class="string">'./app.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">async</span> <span class="function"><span class="keyword">function</span> <span class="title">bootstrap</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule);</span><br><span class="line">  <span class="keyword">await</span> app.listen(<span class="number">3000</span>);</span><br><span class="line">&#125;</span><br><span class="line">bootstrap();</span><br></pre></td></tr></table></figure>
</li>
<li><p>Platform</p>
<p>Nest目的是一个平台无关的框架，平台无关性使得Nest能够创建开发者能够用在不同类型应用的可重用的逻辑部分。技术上，Nest能够和任何HTTP框架一起工作，只要创建响应的adapter。有两个HTTP框架平台已经被支持：<strong>express</strong> 和 <strong>fastify</strong></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create&lt;NestExpressApplication&gt;(AppModule);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>运行应用</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">npm run start</span></span><br></pre></td></tr></table></figure>
<p>访问地址 <a href="http://localhost:3000/" target="_blank" rel="noopener">http://localhost:3000/</a></p>
</li>
</ol>
<h2 id="Controllers"><a href="#Controllers" class="headerlink" title="Controllers"></a>Controllers</h2><p>Controllers用于处理输入的请求，然后返回响应给客户端。</p>
<p>Controller的目的是接受特定的请求，路由机制控制Controller接受什么请求。每个Controller超过一个路由，不同的路由执行不同的操作。</p>
<h3 id="Routing"><a href="#Routing" class="headerlink" title="Routing"></a>Routing</h3><p><code>@Controller()</code>装饰器，用于定义一个基础的Controller。</p>
<p>使用下面命令创建一个Controller：</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">nest g controller cats</span></span><br></pre></td></tr></table></figure>
<p><code>src/cats/cats.controller.ts</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'cats'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsController &#123;</span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  findAll(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'This action returns all cats'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>在<code>@Controller()</code>装饰器熵指定路径前缀能够更加容易将一组相关的路由分组，减少重复的code。</p>
<p><code>findAll()</code>method上的<code>@Get()</code> HTTP Request method装饰器告诉Nest为一个具体的HTTP Requestschungking一个处理器。由于没有指定prefix，默认会处理<code>GEt /cat</code>请求。</p>
<p>控制响应的不同方法：</p>
<ul>
<li><p>Standard (recommended)</p>
<p>当request handler返回的是一个JavaScript对象或数组，它将会自动的序列化为JSON，当返回的是一个JavaScript基本类型，比如<code>string，number,boolean</code>，Nest发送对应的value，不会序列化。</p>
<p>进一步，响应的status code 默认总是200，除了POST requests使用201。我们也可以使用<code>@HttpCode(...)</code>装饰器来修改。</p>
</li>
</ul>
<ul>
<li><p>Library-specific</p>
<p>我们可以使用library-specific(e.g.,Express) response object，能够使用<code>@Res()</code>装饰器来注入到handler signature上，(e.g <code>findAll(@Res() response)</code>)。通过这种方式，可以使用原始的response处理方法。例如，对于Express，可以使用代码构造响应码<code>response.status(200).send()</code></p>
<p>注意：这两种方式不能同时使用。</p>
</li>
</ul>
<h3 id="Request-object"><a href="#Request-object" class="headerlink" title="Request object"></a>Request object</h3><p>Handers通常需要获得客户端request的详细情况，Nest提供了在platform下获取请求对象的方法，我们能够通过注入<code>@Req()</code>来实现</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Req &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request &#125; <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'cats'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsController &#123;</span><br><span class="line">    <span class="meta">@Get</span>()</span><br><span class="line">    findAll(<span class="meta">@Req</span>() request: Request) : <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This action returns all cats"</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>提示：为了使用<code>express</code> ,需要安装<code>@types/express</code>包</p>
<p>请求对象表示HTTP Request并且有请求查询字符串属性、参数、HTTP头、以及body等等。在大多数情况下，不需要手动获取这些属性。可以使用专用装饰器来代替，比如<code>@Body() or  @Query()</code></p>
<div class="table-container">
<table>
<thead>
<tr>
<th>装饰器</th>
<th></th>
</tr>
</thead>
<tbody>
<tr>
<td>@Request().@Res()</td>
<td>req</td>
</tr>
<tr>
<td>@Response(),@Res()</td>
<td>res</td>
</tr>
<tr>
<td>@Next()</td>
<td>next</td>
</tr>
<tr>
<td>@Session()</td>
<td>req.session</td>
</tr>
<tr>
<td>@Param(key?: string)</td>
<td>req.params / req.param[key]</td>
</tr>
<tr>
<td>@Body(key?: string)</td>
<td>req.body / req.body[key]</td>
</tr>
<tr>
<td>@Query(key?: string)</td>
<td>req.query / req.query[key]</td>
</tr>
<tr>
<td>@Headers(key?: string)</td>
<td>req.headers / req.headers[key]</td>
</tr>
<tr>
<td>@Ip()</td>
<td>req.ip</td>
</tr>
</tbody>
</table>
</div>
<p>注：当在方法使用了<code>@Res() or @Response()</code>，对于这个handler进入library-specific mode。必须手动处理响应。<code>e.g res.json(...) or res.send(...)</code>。否则HTTP Server将会宕机。</p>
<p>自定义装饰器：<a href="https://docs.nestjs.com/custom-decorators" target="_blank" rel="noopener">https://docs.nestjs.com/custom-decorators</a></p>
<h3 id="Resources"><a href="#Resources" class="headerlink" title="Resources"></a>Resources</h3><p>前面我们定义了endpoint来获取 cats resource (GET route)。也可以创建新的endpoint。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Req, Post, Res &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request,Response &#125; <span class="keyword">from</span> <span class="string">'express'</span></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'cats'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsController &#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Post</span>()</span><br><span class="line">    create() : <span class="built_in">string</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"This action adds a new cat"</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Get</span>()</span><br><span class="line">    findAll(<span class="meta">@Req</span>() request: Request,<span class="meta">@Res</span>() res: Response) : <span class="built_in">string</span>|<span class="built_in">void</span> &#123;</span><br><span class="line">        <span class="comment">// return "This action returns all cats";</span></span><br><span class="line">        res.send(&#123;</span><br><span class="line">            status: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Nest也提供了其他的标准HTTP request endpoint 装饰器 <code>@Put() @Delete() @Patch() @Options() @Head() @All()</code></p>
<h3 id="Route-wildcards-路由通配符"><a href="#Route-wildcards-路由通配符" class="headerlink" title="Route wildcards 路由通配符"></a>Route wildcards 路由通配符</h3><p>Nest也支持路由模式，比如可以使用星号作为通配符，来匹配任何字符的组合</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">'ab*cd'</span>)</span><br><span class="line">test()&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'This route uses a wildcar'</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>ab*cd</code>这个route path将匹配<code>abcd,ab_cd,abecd</code>等等。</p>
<p>符号<code>？，+，*,()</code>也可以使用在route path上，</p>
<h3 id="Status-code"><a href="#Status-code" class="headerlink" title="Status code"></a>Status code</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>()</span><br><span class="line"><span class="meta">@HttpCode</span>(<span class="number">204</span>)</span><br><span class="line">create() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'This action adds a new cat'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：<code>HttpCode</code>来源<code>@nestjs/common</code></p>
<h3 id="Headers"><a href="#Headers" class="headerlink" title="Headers"></a>Headers</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>()</span><br><span class="line"><span class="meta">@Header</span>(<span class="string">'Cache-Control'</span>, <span class="string">'none'</span>)</span><br><span class="line">create() &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'This action adds a new cat'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Redirection"><a href="#Redirection" class="headerlink" title="Redirection"></a>Redirection</h3><p>使用<code>@Redirect()</code>或者 library-specific response object 执行<code>res.redirect()</code></p>
<p><code>@Redirect()</code>需要一个<code>url</code>参数以及可选的<code>statusCode</code>参数，<code>statusCode</code>默认为<code>302</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>()</span><br><span class="line"><span class="meta">@Redirect</span>(<span class="string">'https://nestjs.com'</span>, <span class="number">301</span>)</span><br></pre></td></tr></table></figure>
<p>有时，需要动态的决定HTTP status code 或者 重定向的 URL，可以在route handler返回一个固定格式的对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"url"</span>: <span class="built_in">string</span>,</span><br><span class="line">  <span class="string">"statusCode"</span>: <span class="built_in">number</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">'docs'</span>)</span><br><span class="line"><span class="meta">@Redirect</span>(<span class="string">'https://docs.nestjs.com'</span>, <span class="number">302</span>)</span><br><span class="line">getDocs(<span class="meta">@Query</span>(<span class="string">'version'</span>) version) &#123;</span><br><span class="line">  <span class="keyword">if</span> (version &amp;&amp; version === <span class="string">'5'</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> &#123; url: <span class="string">'https://docs.nestjs.com/v5/'</span> &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Route-parameters"><a href="#Route-parameters" class="headerlink" title="Route parameters"></a>Route parameters</h3><p>当接受的动态数据是请求的一部分时，静态的路径将会无法工作。(e.g., GET /cats/1 to get cat with id 1).</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">':id'</span>)</span><br><span class="line">findOne(<span class="meta">@Param</span>() params): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(params.id);</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`This action returns a #<span class="subst">$&#123;params.id&#125;</span> cat`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Get</span>(<span class="string">':id'</span>)</span><br><span class="line">findOne(<span class="meta">@Param</span>(<span class="string">'id'</span>) id): <span class="built_in">string</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">`This action returns a #<span class="subst">$&#123;id&#125;</span> cat`</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Sub-Domain-Routing"><a href="#Sub-Domain-Routing" class="headerlink" title="Sub-Domain Routing"></a>Sub-Domain Routing</h3><p><code>@Controller()</code>的<code>host</code>选项可以匹配请求的HTTP host</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(&#123; host: <span class="string">'admin.example.com'</span> &#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AdminController &#123;</span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  index(): <span class="built_in">string</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'Admin page'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>和路径相似，<code>host</code>也可以使用动态值</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Controller</span>(&#123; host: <span class="string">':account.example.com'</span> &#125;) <span class="keyword">export</span> <span class="keyword">class</span> AccountController </span><br><span class="line">&#123; </span><br><span class="line">    <span class="meta">@Get</span>()</span><br><span class="line"> 	getInfo(<span class="meta">@HostParam</span>(<span class="string">'account'</span>) account: <span class="built_in">string</span>) &#123; </span><br><span class="line">        <span class="keyword">return</span> account; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Scopes"><a href="#Scopes" class="headerlink" title="Scopes"></a>Scopes</h3><p><a href="https://docs.nestjs.com/fundamentals/injection-scopes" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/injection-scopes</a></p>
<h3 id="Asynchronicity"><a href="#Asynchronicity" class="headerlink" title="Asynchronicity"></a>Asynchronicity</h3><p>数据处理大部分是异步的，这就是为什么Nest支持<code>async</code>函数</p>
<p><a href="https://kamilmysliwiec.com/typescript-2-1-introduction-async-await" target="_blank" rel="noopener">https://kamilmysliwiec.com/typescript-2-1-introduction-async-await</a></p>
<p>每个async 函数必须返回一个<code>Promise</code>，</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">@Get</span>()</span><br><span class="line"><span class="keyword">async</span> findAll(): <span class="built_in">Promise</span>&lt;<span class="built_in">any</span>[]&gt; &#123;</span><br><span class="line">  <span class="keyword">return</span> [];</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的代码是完全有效的，Nest route handle更加强大，能够返回一个 RxJS observable streams.</p>
<p><a href="http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html" target="_blank" rel="noopener">http://reactivex.io/rxjs/class/es6/Observable.js~Observable.html</a></p>
<p>Nest将会自定订阅下面的源，一旦这个stream完成，产生最后的值</p>
<h3 id="Request-payloads"><a href="#Request-payloads" class="headerlink" title="Request payloads"></a>Request payloads</h3><p>上面的POST例子不能接受任何客户端参数，可以通过增加<code>@Body()</code>解决。</p>
<p>首先定义一个DTO (Data Transfer Object) schema。DTO用于定义数据在网络上发送。我们可以使用TypeScript 接口或类来定义。Nest推荐使用class。</p>
<p>create-cat.dto.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CreateCatDto &#123;</span><br><span class="line">  name: <span class="built_in">string</span>;</span><br><span class="line">  age: <span class="built_in">number</span>;</span><br><span class="line">  breed: <span class="built_in">string</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Post</span>()</span><br><span class="line"><span class="keyword">async</span> create(<span class="meta">@Body</span>() createCatDto: CreateCatDto) &#123;</span><br><span class="line">  <span class="keyword">return</span> <span class="string">'This action adds a new cat'</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="完整例子"><a href="#完整例子" class="headerlink" title="完整例子"></a>完整例子</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Query, Post, Body, Put, Param, Delete &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CreateCatDto, UpdateCatDto, ListAllEntities &#125; <span class="keyword">from</span> <span class="string">'./dto'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'cats'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsController &#123;</span><br><span class="line">  <span class="meta">@Post</span>()</span><br><span class="line">  create(<span class="meta">@Body</span>() createCatDto: CreateCatDto) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">'This action adds a new cat'</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  findAll(<span class="meta">@Query</span>() query: ListAllEntities) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This action returns all cats (limit: <span class="subst">$&#123;query.limit&#125;</span> items)`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>(<span class="string">':id'</span>)</span><br><span class="line">  findOne(<span class="meta">@Param</span>(<span class="string">'id'</span>) id: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This action returns a #<span class="subst">$&#123;id&#125;</span> cat`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Put</span>(<span class="string">':id'</span>)</span><br><span class="line">  update(<span class="meta">@Param</span>(<span class="string">'id'</span>) id: <span class="built_in">string</span>, <span class="meta">@Body</span>() updateCatDto: UpdateCatDto) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This action updates a #<span class="subst">$&#123;id&#125;</span> cat`</span>;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Delete</span>(<span class="string">':id'</span>)</span><br><span class="line">  remove(<span class="meta">@Param</span>(<span class="string">'id'</span>) id: <span class="built_in">string</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">`This action removes a #<span class="subst">$&#123;id&#125;</span> cat`</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Getting-up-and-running"><a href="#Getting-up-and-running" class="headerlink" title="Getting up and running"></a>Getting up and running</h3><p>当上面的操作全部完成，Nest现在还是不知道<code>CatsController</code>存在，也不会创建相应的实例。</p>
<p>Controllers总是属于一个模块，这就是为什么<code>@Module()</code>装饰器包含<code>controllers</code>数组。因为还没有定义其他模块，除了 root <code>AppModule</code>。</p>
<p>app.module.ts</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.controller'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [CatsController],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Providers"><a href="#Providers" class="headerlink" title="Providers"></a>Providers</h2><p>Providers 是 Nest中一个基础的概念。许多基础的Nest Classes作为 provider——services,repositories,factories,helpers等等。provider的主要特征是可以注入依赖，意味这对象能够和其他对象创建各种关系。</p>
<p>一个provider能够通过<code>@Injectable()</code>来注解</p>
<p><img src="/images/nestjs/Components_1.png" alt="Components_1"></p>
<p>Controllers用于处理HTTP请求，更复杂的任务委派给 providers。providers是一个纯JavaScript Class。</p>
<h3 id="Service"><a href="#Service" class="headerlink" title="Service"></a>Service</h3><p>创建一个简单的<code>CatsService</code>，这个service用于数据存储和检索，设计给<code>CatsController</code>使用，所以适合被定义为一个provider。</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nest g service cats</span></span><br></pre></td></tr></table></figure>
<p>使用上面的命令生成：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Cat &#125; <span class="keyword">from</span> <span class="string">'./interfaces/cat.interface'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsService &#123;</span><br><span class="line">  <span class="keyword">private</span> readonly cats: Cat[] = [];</span><br><span class="line"></span><br><span class="line">  create(cat: Cat) &#123;</span><br><span class="line">    <span class="keyword">this</span>.cats.push(cat);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  findAll(): Cat[] &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.cats;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>@Injectable()</code>装饰器对<code>CatsService</code>增加了一些元数据，这些元数据告诉Nest这个类是一个 Nest Provider。</p>
<p>修改<code>CatsController</code>，使用service来检索数据</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Controller, Get, Post, Body &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CreateCatDto &#125; <span class="keyword">from</span> <span class="string">'./dto/create-cat.dto'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats.service'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Cat &#125; <span class="keyword">from</span> <span class="string">'./interfaces/cat.interface'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Controller</span>(<span class="string">'cats'</span>)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsController &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> catsService: CatsService</span>) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Post</span>()</span><br><span class="line">  <span class="keyword">async</span> create(<span class="meta">@Body</span>() createCatDto: CreateCatDto) &#123;</span><br><span class="line">    <span class="keyword">this</span>.catsService.create(createCatDto);</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="meta">@Get</span>()</span><br><span class="line">  <span class="keyword">async</span> findAll(): <span class="built_in">Promise</span>&lt;Cat[]&gt; &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.catsService.findAll();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>CatsService</code>通过class 构造器注入，注意private的使用。</p>
<p>这种方式允许在同一个位置立刻同时声明和初始化<code>catsService</code>成员</p>
<h3 id="Dependency-injection"><a href="#Dependency-injection" class="headerlink" title="Dependency injection"></a>Dependency injection</h3><p>Nest 使用强大的设计模式 Dependency injection。</p>
<p>We recommend reading a great article about this concept in the official <a href="https://angular.io/guide/dependency-injection" target="_blank" rel="noopener">Angular</a> documentation.</p>
<p>在Nest中，由于TypeScript的能力，很容易管理依赖，因为它们被当作Type处理。在下面的例子中，Nest通过创建返回<code>CatsService</code>实例来处理<code>catsService</code>。(在单例的情况下，如果它已经在其他地方被请求了，就会返回一个存在的实例。)这个依赖传入到controllers的构造器中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> catsService: CatsService</span>) &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Scope"><a href="#Scope" class="headerlink" title="Scope"></a>Scope</h3><p>Provider也有声明周期，和应用的生命周期同步，当应用启动，每个依赖必须被处理，然后每个provider必须被实例化，相似的，当应用关闭了，每个provider将被销毁。然而，也有方法可以让provider生命周期在<strong>request-scoped</strong>。</p>
<p><a href="https://docs.nestjs.com/fundamentals/injection-scopes" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/injection-scopes</a></p>
<h3 id="Custom-providers"><a href="#Custom-providers" class="headerlink" title="Custom providers"></a>Custom providers</h3><p>Nest拥有内置的Ioc(inversion of control)来处理providers之间的关系。这个特性依赖上面的依赖注入特性，事实上，比我们描述的更加强大。<code>@Injectable()</code>装饰器只是冰山一角，它也不是唯一的定义provider的方式。事实上，可以使用纯数值，类，其他的同步异步的工厂来生成。</p>
<p><a href="https://docs.nestjs.com/fundamentals/dependency-injection" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/dependency-injection</a></p>
<h3 id="Optional-providers"><a href="#Optional-providers" class="headerlink" title="Optional providers"></a>Optional providers</h3><p>偶尔，有些dependencies不必须要处理。例如，某些class依赖一个<strong>configuration object</strong>，但当传入的是none，默认的值应该被使用。</p>
<p>在这样的例子中，这样的依赖变得可选的。因为失去配置provider并不会导致错误。</p>
<p>为了表明provider是可选的，需要使用<code>@Optional()</code>在构造器的参数上。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, Optional, Inject &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HttpService&lt;T&gt; &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="meta">@Optional</span>() <span class="meta">@Inject</span>(<span class="string">'HTTP_OPTIONS'</span>) <span class="keyword">private</span> httpClient: T</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的例子中使用了自定义provider的原因是使用了<code>HTTP_OPTION</code>自定义符号。</p>
<p><a href="https://docs.nestjs.com/fundamentals/custom-providers" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/custom-providers</a></p>
<h3 id="Property-based-injection"><a href="#Property-based-injection" class="headerlink" title="Property-based injection"></a>Property-based injection</h3><p>上面以及使用的技术是基于构造器的注入，通过构造器方法注入provider。</p>
<p>在一些特殊情况下，基于属性的注入也许是有用的。</p>
<p>例如，如果你的顶层类依赖一个或多个provider。在构造器中子类中通过使用<code>super()</code>来获得它们是非常麻烦的。为了避免这些，可以在属性上使用<code>@Inject()</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, Inject &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> HttpService&lt;T&gt; &#123;</span><br><span class="line">  <span class="meta">@Inject</span>(<span class="string">'HTTP_OPTIONS'</span>)</span><br><span class="line">  <span class="keyword">private</span> readonly httpClient: T;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：如果你的类没有扩展其他的provider，最好使用基于构造器的注入。</p>
<h3 id="Provider-registration"><a href="#Provider-registration" class="headerlink" title="Provider registration"></a>Provider registration</h3><p>现在已经定义了一个provider(<code>CatService</code>)，以及使用者<code>CatsController</code>。我们需要注册这个service到Nest中去，这样才能实现注入。这就需要编辑<code>app.module.ts</code>，增加service到<code>@Module()</code>中的<code>providers</code>数组中去。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [CatsController],</span><br><span class="line">  providers: [CatsService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Manual-instantiation"><a href="#Manual-instantiation" class="headerlink" title="Manual instantiation"></a>Manual instantiation</h3><p>Thus far, we’ve discussed how Nest automatically handles most of the details of resolving dependencies. In certain circumstances, you may need to step outside of the built-in Dependency Injection system and manually retrieve or instantiate providers. We briefly discuss two such topics below.</p>
<p>To get existing instances, or instantiate providers dynamically, you can use <a href="https://docs.nestjs.com/fundamentals/module-ref" target="_blank" rel="noopener">Module reference</a>.</p>
<p>To get providers within the <code>bootstrap()</code> function (for example for standalone applications without controllers, or to utilize a configuration service during bootstrapping) see <a href="https://docs.nestjs.com/standalone-applications" target="_blank" rel="noopener">Standalone applications</a>.</p>
<h2 id="Modules"><a href="#Modules" class="headerlink" title="Modules"></a>Modules</h2><p>module是一个使用了<code>@Module()</code>装饰器的类，<code>@Module()</code>提供元数据使得Nest组织应用架构。</p>
<p><img src="/images/nestjs/Modules_1.png" alt="Modules_1"></p>
<p>每个应用至少有一个module，即<strong>root module</strong>。root module是Nest的起点用于构建 <strong>application graph</strong>——内部的数据结构用于处理module和provider关系和依赖。理论上，非常小的应用只有root module。modules强力推荐的用于组织应用的方式。</p>
<p><code>@Module()</code>有以下属性，用于描述这个module:</p>
<div class="table-container">
<table>
<thead>
<tr>
<th>property</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>providers</td>
<td>将会被实例化的provider,在这个module共享使用</td>
</tr>
<tr>
<td>controllers</td>
<td>在这个模块内定义controllers，必须被实例化</td>
</tr>
<tr>
<td>imports</td>
<td>导出该模块所需的提供程序的导入模块的列表</td>
</tr>
<tr>
<td>exports</td>
<td>当前module提供给其他模块导入使用的providers子集</td>
</tr>
</tbody>
</table>
</div>
<h3 id="Feature-modules"><a href="#Feature-modules" class="headerlink" title="Feature modules"></a>Feature modules</h3><p><code>CatsController</code>和<code>catsService</code>紧密关联，将它们移入到一个 feature module中是有意义的，feature module 组织相关的代码。</p>
<p>创建<code>CatModule</code></p>
<p>cats.module.ts</p>
<p>运行命令</p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash">nest g module cats</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">    controllers: [CatsController],</span><br><span class="line">    providers: [CatsService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>上面，在<code>cats.module.ts</code>中定义了<code>CatsModule</code>，将所有相关的模块移入<code>cats</code>文件夹。最后需要做的是导入这个module到root module中(<code>AppModule in app.module.ts file</code>)。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsModule &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [CatsModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Shared-modules"><a href="#Shared-modules" class="headerlink" title="Shared modules"></a>Shared modules</h3><p>Nest中，module默认是单例的，然而可以在多个modules中共享同一个provider实例。</p>
<p><img src="/images/nestjs/Shared_Module_1.png" alt="Shared_Module_1"></p>
<p>每个module自动是一个 shared module。一旦被创建，它就可以被任何modul重用。假如我们想要分享<code>CatsService</code>给其他模块。为了实现这个，首先需要export <code>CatsService</code>，通过增加它到module的<code>exports</code>数组中。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [CatsController],</span><br><span class="line">  providers: [CatsService],</span><br><span class="line">  exports: [CatsService]</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>现在，任何modue能够导入<code>CatsModule</code>来获得<code>CatsService</code>。</p>
<h3 id="Module-re-exporting"><a href="#Module-re-exporting" class="headerlink" title="Module re-exporting"></a>Module re-exporting</h3><p>正如上面，Modules能够导入它们内部的providers。此外，它们能re-export 它们导入的模块。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [CommonModule],</span><br><span class="line">  exports: [CommonModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CoreModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Dependency-injection-1"><a href="#Dependency-injection-1" class="headerlink" title="Dependency injection"></a>Dependency injection</h3><p>module类也能够注入providers。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [CatsController],</span><br><span class="line">  providers: [CatsService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsModule &#123;</span><br><span class="line">  <span class="keyword">constructor</span>(<span class="params"><span class="keyword">private</span> catsService: CatsService</span>) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：模板本身不能像providers被注入<a href="https://docs.nestjs.com/fundamentals/circular-dependency" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/circular-dependency</a></p>
<h3 id="Global-modules"><a href="#Global-modules" class="headerlink" title="Global modules"></a>Global modules</h3><p>如果，你必须在任何地方导入同样的module集合，它将会非常繁琐。和Nest不一样，Angular provider能够注册到全局范围。一旦定义，它们能够在任何地方获得。然而，Nest将provider封装在module scope内，当没有导入到当前module中，无法使用这个模块的provider。</p>
<p>当你想要提供一系列能够在任何地方获得的providers,(e.g. helpers, database connections, etc.)。我们可以使用<code>@Global()</code>实现module global。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, Global &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats.controller'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsService &#125; <span class="keyword">from</span> <span class="string">'./cats.service'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Global</span>()</span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  controllers: [CatsController],</span><br><span class="line">  providers: [CatsService],</span><br><span class="line">  exports: [CatsService],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> CatsModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>上面例子中，<code>CatsService</code> provider 将会无处不在，module希望注入service，而不需要在imports 数组中导入<code>CatsModule</code>。</p>
<h3 id="Dynamic-modules"><a href="#Dynamic-modules" class="headerlink" title="Dynamic modules"></a>Dynamic modules</h3><p>动态模块能够让我们创建自定义的modules，这些模块能够动态注册和配置providers。<a href="https://docs.nestjs.com/fundamentals/dynamic-modules" target="_blank" rel="noopener">https://docs.nestjs.com/fundamentals/dynamic-modules</a></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, DynamicModule &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; createDatabaseProviders &#125; <span class="keyword">from</span> <span class="string">'./database.providers'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Connection &#125; <span class="keyword">from</span> <span class="string">'./connection.provider'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  providers: [Connection],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> DatabaseModule &#123;</span><br><span class="line">  <span class="keyword">static</span> forRoot(entities = [], options?): DynamicModule &#123;</span><br><span class="line">    <span class="keyword">const</span> providers = createDatabaseProviders(options, entities);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      <span class="keyword">module</span>: DatabaseModule,</span><br><span class="line">      providers: providers,</span><br><span class="line">      exports: providers,</span><br><span class="line">    &#125;;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>forRoot()</code>method返回一个动态模块</p>
<p>如果想在全局范围注册一个动态模块，设置<code>global</code>属性为<code>true</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  global: <span class="literal">true</span>,</span><br><span class="line">  <span class="keyword">module</span>: DatabaseModule,</span><br><span class="line">  providers: providers,</span><br><span class="line">  exports: providers,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><code>DatabasesModule</code>能够以下面的方式导入和配置：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; DatabaseModule &#125; <span class="keyword">from</span> <span class="string">'./database/database.module'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">'./users/entities/user.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [DatabaseModule.forRoot([User])],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<p>如果想要re-export动态模块，可以在exports数组中忽略<code>forRoot()</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; DatabaseModule &#125; <span class="keyword">from</span> <span class="string">'./database/database.module'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; User &#125; <span class="keyword">from</span> <span class="string">'./users/entities/user.entity'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [DatabaseModule.forRoot([User])],</span><br><span class="line">  exports: [DatabaseModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule &#123;&#125;</span><br></pre></td></tr></table></figure>
<h2 id="Middleware"><a href="#Middleware" class="headerlink" title="Middleware"></a>Middleware</h2><p>中间件是一个在route handler之前执行的函数。中间件能够获得请求和响应对象，以及在应用的请求-响应环中的<code>next()</code>中间件函数。The next function通常被记作名为<code>next</code>的变量名。</p>
<p><img src="/images/nestjs/Middlewares_1.png" alt="Middlewares_1"></p>
<p>Nest middleware默认和express middleware是一样的。下面是来源express docment中描述middleware的能力：</p>
<blockquote>
<p>Middleware functions can perform the following tasks:</p>
<ul>
<li>execute any code.</li>
<li>make changes to the request and the response objects.</li>
<li>end the request-response cycle.</li>
<li>call the next middleware function in the stack.</li>
<li>if the current middleware function does not end the request-response cycle, it must call <code>next()</code> to pass control to the next middleware function. Otherwise, the request will be left hanging.</li>
</ul>
</blockquote>
<p>可以通过<code>@Injectable()</code>的class或函数实现中间件。class应当implement <code>NestMiddleware</code>接口。函数没有任何特殊要求。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Injectable, NestMiddleware &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; Request, Response &#125; <span class="keyword">from</span> <span class="string">'express'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Injectable</span>()</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> LoggerMiddleware <span class="keyword">implements</span> NestMiddleware &#123;</span><br><span class="line">  use(req: Request, res: Response, next: <span class="built_in">Function</span>) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'Request...'</span>);</span><br><span class="line">    next();</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h3 id="Dependency-injection-2"><a href="#Dependency-injection-2" class="headerlink" title="Dependency injection"></a>Dependency injection</h3><p>Nest middleware完全支持依赖注入，和providers和controllers一样，能够在同一个module中注入可获得的依赖。通常，通过构造器注入。</p>
<h3 id="Applying-middleware"><a href="#Applying-middleware" class="headerlink" title="Applying middleware"></a>Applying middleware</h3><p>在<code>@Module()</code>没有地方配置middleware。通过使用module class的<code>configure()</code>方法来设置。包含middleware的module必须实现<code>NestModule</code>接口。</p>
<p>下面将在<code>AppModule</code>中设置<code>LoggerMiddleware</code></p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, NestModule, MiddlewareConsumer &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoggerMiddleware &#125; <span class="keyword">from</span> <span class="string">'./common/middleware/logger.middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsModule &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [CatsModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule <span class="keyword">implements</span> NestModule &#123;</span><br><span class="line">  configure(consumer: MiddlewareConsumer) &#123;</span><br><span class="line">    consumer</span><br><span class="line">      .apply(LoggerMiddleware)</span><br><span class="line">      .forRoutes(<span class="string">'cats'</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, NestModule, RequestMethod, MiddlewareConsumer &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoggerMiddleware &#125; <span class="keyword">from</span> <span class="string">'./common/middleware/logger.middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsModule &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.module'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [CatsModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule <span class="keyword">implements</span> NestModule &#123;</span><br><span class="line">  configure(consumer: MiddlewareConsumer) &#123;</span><br><span class="line">    consumer</span><br><span class="line">      .apply(LoggerMiddleware)</span><br><span class="line">      .forRoutes(&#123; path: <span class="string">'cats'</span>, method: RequestMethod.GET &#125;);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>上面的<code>configure()</code>方法能够使用<code>async/await</code>异步化。</p>
<h3 id="Route-wildcards"><a href="#Route-wildcards" class="headerlink" title="Route wildcards"></a>Route wildcards</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">forRoutes(&#123; path: <span class="string">'ab*cd'</span>, method: RequestMethod.ALL &#125;);</span><br></pre></td></tr></table></figure>
<h3 id="Middleware-consumeer"><a href="#Middleware-consumeer" class="headerlink" title="Middleware consumeer"></a>Middleware consumeer</h3><p>MiddlewareConsumer是一个帮助类，它提供了几个内置的方法来管理middleware。它们能够以流式风格连起来。<code>forRoutes()</code>能够输入一个单个字符串、多个字符串、<code>RouteInfo</code>对象，controller class 甚至多个controller classes。</p>
<p>大多数情况，可以传入一个controllers列表，使用都好分开。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; Module, NestModule, MiddlewareConsumer &#125; <span class="keyword">from</span> <span class="string">'@nestjs/common'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; LoggerMiddleware &#125; <span class="keyword">from</span> <span class="string">'./common/middleware/logger.middleware'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsModule &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.module'</span>;</span><br><span class="line"><span class="keyword">import</span> &#123; CatsController &#125; <span class="keyword">from</span> <span class="string">'./cats/cats.controller.ts'</span>;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Module</span>(&#123;</span><br><span class="line">  imports: [CatsModule],</span><br><span class="line">&#125;)</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">class</span> AppModule <span class="keyword">implements</span> NestModule &#123;</span><br><span class="line">  configure(consumer: MiddlewareConsumer) &#123;</span><br><span class="line">    consumer</span><br><span class="line">      .apply(LoggerMiddleware)</span><br><span class="line">      .forRoutes(CatsController);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注：<code>apply()</code>可以输入单个middleware或多个参数来指定多个middlewares。</p>
<p><a href="https://docs.nestjs.com/middleware#multiple-middleware" target="_blank" rel="noopener">https://docs.nestjs.com/middleware#multiple-middleware</a></p>
<h3 id="Excluding-routes"><a href="#Excluding-routes" class="headerlink" title="Excluding routes"></a>Excluding routes</h3><p>有时需要排除确定的routes。我们可以使用<code>exclude()</code>实现，This method can take a single string, multiple strings, or a <code>RouteInfo</code> object identifying routes to be excluded, as shown below:</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">consumer</span><br><span class="line">  .apply(LoggerMiddleware)</span><br><span class="line">  .exclude(</span><br><span class="line">    &#123; path: <span class="string">'cats'</span>, method: RequestMethod.GET &#125;,</span><br><span class="line">    &#123; path: <span class="string">'cats'</span>, method: RequestMethod.POST &#125;,</span><br><span class="line">    <span class="string">'cats/(.*)'</span>,</span><br><span class="line">  )</span><br><span class="line">  .forRoutes(CatsController);</span><br></pre></td></tr></table></figure>
<h3 id="Functional-middleware"><a href="#Functional-middleware" class="headerlink" title="Functional middleware"></a>Functional middleware</h3><p>上面使用的<code>LoggerMiddleware</code>是非常简单的，它没有成员、没有额外的方法和依赖。我们可以把它定义为一个简单的函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">logger</span>(<span class="params">req, res, next</span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">`Request...`</span>);</span><br><span class="line">  next();</span><br><span class="line">&#125;;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">consumer</span><br><span class="line">  .apply(logger)</span><br><span class="line">  .forRoutes(CatsController);</span><br></pre></td></tr></table></figure>
<h3 id="Multiple-middleware"><a href="#Multiple-middleware" class="headerlink" title="Multiple middleware"></a>Multiple middleware</h3><p>为了绑定多个middleware，它们按照顺序执行。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">consumer.apply(cors(), helmet(), logger).forRoutes(CatsController);</span><br></pre></td></tr></table></figure>
<h3 id="Globle-middleware"><a href="#Globle-middleware" class="headerlink" title="Globle middleware"></a>Globle middleware</h3><figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="keyword">await</span> NestFactory.create(AppModule);</span><br><span class="line">app.use(logger);</span><br><span class="line"><span class="keyword">await</span> app.listen(<span class="number">3000</span>);</span><br></pre></td></tr></table></figure>
<h2 id="Exception-filters"><a href="#Exception-filters" class="headerlink" title="Exception filters"></a>Exception filters</h2><h2 id="参考来源"><a href="#参考来源" class="headerlink" title="参考来源"></a>参考来源</h2><p>官网<a href="https://docs.nestjs.com/first-steps" target="_blank" rel="noopener">https://docs.nestjs.com/first-steps</a></p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  

      
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://yoursite.com/2020/04/09/TypeScript-Tutorial/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="DongxianGu">
      <meta itemprop="description" content="Life,Happy,Code">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Summer So Cold">
    </span>
      <header class="post-header">
        <h2 class="post-title" itemprop="name headline">
          
            <a href="/2020/04/09/TypeScript-Tutorial/" class="post-title-link" itemprop="url">TypeScript_Tutorial</a>
        </h2>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>
              

              <time title="创建时间：2020-04-09 19:02:27 / 修改时间：21:21:24" itemprop="dateCreated datePublished" datetime="2020-04-09T19:02:27+08:00">2020-04-09</time>
            </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BC%96%E7%A8%8B%E8%AF%AD%E8%A8%80/" itemprop="url" rel="index"><span itemprop="name">编程语言</span></a>
                </span>
            </span>

          
  
  <span class="post-meta-item">
    
      <span class="post-meta-item-icon">
        <i class="far fa-comment"></i>
      </span>
      <span class="post-meta-item-text">Valine：</span>
    
    <a title="valine" href="/2020/04/09/TypeScript-Tutorial/#valine-comments" itemprop="discussionUrl">
      <span class="post-comments-count valine-comment-count" data-xid="/2020/04/09/TypeScript-Tutorial/" itemprop="commentCount"></span>
    </a>
  </span>
  
  

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
          <h1 id="TypeScript-教程"><a href="#TypeScript-教程" class="headerlink" title="TypeScript 教程"></a>TypeScript 教程</h1><blockquote>
<p>ypeScript 是 JavaScript 的一个超集，支持 ECMAScript 6 标准。</p>
<p>TypeScript 由微软开发的自由和开源的编程语言。</p>
<p>TypeScript 设计目标是开发大型应用，它可以编译成纯 JavaScript，编译出来的 JavaScript 可以运行在任何浏览器上。</p>
<p>ypeScript 是一种给 JavaScript 添加特性的语言扩展。增加的功能包括：</p>
<ul>
<li>类型批注和编译时类型检查</li>
<li>类型推断</li>
<li>类型擦除</li>
<li>接口</li>
<li>枚举</li>
<li>Mixin</li>
<li>泛型编程</li>
<li>名字空间</li>
<li>元组</li>
<li>Await</li>
</ul>
<p>以下功能是从 ECMA 2015 反向移植而来：</p>
<ul>
<li>类</li>
<li>模块</li>
<li>lambda 函数的箭头语法</li>
<li>可选参数以及默认参数</li>
</ul>
</blockquote>
<h2 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h2><p>TypeScript程序主要由以下几个部分组成：模块、函数、变量、语句和表达式、注释</p>
<ol>
<li><p>Hello World</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> hello : <span class="built_in">string</span> = <span class="string">"Hello World!"</span></span><br><span class="line"><span class="built_in">console</span>.log(hello)</span><br></pre></td></tr></table></figure>
<p>上面的代码通过<strong>tsc</strong>命令编译</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc Test.ts</span><br></pre></td></tr></table></figure>
<p>得到如下js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> hello = <span class="string">"Hello World!"</span>;</span><br><span class="line"><span class="built_in">console</span>.log(hello);</span><br></pre></td></tr></table></figure>
<p>使用node命令执行js代码</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$node Test.js</span><br><span class="line">Hello World!</span><br></pre></td></tr></table></figure>
<p>可以同时编译多个ts文件：</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc file1.ts file2.ts file3.ts</span><br></pre></td></tr></table></figure>
<p>tsc常用编译参数：</p>
</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">编译参数说明</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center"><strong>—help</strong>显示帮助信息</td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center"><strong>—module</strong>载入扩展模块</td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center"><strong>—target</strong>设置 ECMA 版本</td>
</tr>
<tr>
<td style="text-align:center">4.</td>
<td style="text-align:center"><strong>—declaration</strong>额外生成一个 .d.ts 扩展名的文件。<code>tsc ts-hw.ts --declaration</code>以上命令会生成 ts-hw.d.ts、ts-hw.js 两个文件。</td>
</tr>
<tr>
<td style="text-align:center">5.</td>
<td style="text-align:center"><strong>—removeComments</strong>删除文件的注释</td>
</tr>
<tr>
<td style="text-align:center">6.</td>
<td style="text-align:center"><strong>—out</strong>编译多个文件并合并到一个输出的文件</td>
</tr>
<tr>
<td style="text-align:center">7.</td>
<td style="text-align:center"><strong>—sourcemap</strong>生成一个 sourcemap (.map) 文件。sourcemap 是一个存储源代码与编译代码对应位置映射的信息文件。</td>
</tr>
<tr>
<td style="text-align:center">8.</td>
<td style="text-align:center"><strong>—module noImplicitAny</strong>在表达式和声明上有隐含的 any 类型时报错</td>
</tr>
<tr>
<td style="text-align:center">9.</td>
<td style="text-align:center"><strong>—watch</strong>在监视模式下运行编译器。会监视输出文件，在它们改变时重新编译。</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>保留关键字</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th>break</th>
<th>as</th>
<th>catch</th>
<th>switch</th>
</tr>
</thead>
<tbody>
<tr>
<td>case</td>
<td>if</td>
<td>throw</td>
<td>else</td>
</tr>
<tr>
<td>var</td>
<td>number</td>
<td>string</td>
<td>get</td>
</tr>
<tr>
<td>module</td>
<td>type</td>
<td>instanceof</td>
<td>typeof</td>
</tr>
<tr>
<td>public</td>
<td>private</td>
<td>enum</td>
<td>export</td>
</tr>
<tr>
<td>finally</td>
<td>for</td>
<td>while</td>
<td>void</td>
</tr>
<tr>
<td>null</td>
<td>super</td>
<td>this</td>
<td>new</td>
</tr>
<tr>
<td>in</td>
<td>return</td>
<td>true</td>
<td>false</td>
</tr>
<tr>
<td>any</td>
<td>extends</td>
<td>static</td>
<td>let</td>
</tr>
<tr>
<td>package</td>
<td>implements</td>
<td>interface</td>
<td>function</td>
</tr>
<tr>
<td>new</td>
<td>try</td>
<td>yield</td>
<td>const</td>
</tr>
<tr>
<td>continue</td>
<td>do</td>
<td></td>
</tr>
</tbody>
</table>
</div>
<p>   TypeScript</p>
<ul>
<li>忽略程序中出现的空格、制表符和换行符</li>
<li>区分大小写字符</li>
<li><p>每段指令都是一段语句，可以使用分号或者不使用。写在同一行的语句一定要使用分号来分割。</p>
<p>注释</p>
</li>
<li><p>单行注释 //</p>
</li>
<li>多行注释 /**/</li>
</ul>
<ol>
<li><p>面向对象</p>
<p>TypeScript是一种面向对象的编程语言。</p>
<ul>
<li><strong>对象</strong>：对象是类的一个实例（<strong>对象不是找个女朋友</strong>），有状态和行为。例如，一条狗是一个对象，它的状态有：颜色、名字、品种；行为有：摇尾巴、叫、吃等。</li>
<li><strong>类</strong>：类是一个模板，它描述一类对象的行为和状态。</li>
<li><strong>方法</strong>：方法是类的操作的实现步骤。</li>
</ul>
<p>面向对象编程实例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Site &#123; </span><br><span class="line">   name():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"Runoob"</span>) </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Site(); </span><br><span class="line">obj.name();</span><br></pre></td></tr></table></figure>
<p>编译后生成的JavaScript代码如下：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Site = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Site</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    Site.prototype.name = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"Runoob"</span>);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Site;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Site();</span><br><span class="line">obj.name();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="基础类型"><a href="#基础类型" class="headerlink" title="基础类型"></a>基础类型</h2><div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">数据类型</th>
<th style="text-align:left">关键字</th>
<th style="text-align:left">描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">任意类型</td>
<td style="text-align:left">any</td>
<td style="text-align:left">声明为 any 的变量可以赋予任意类型的值。</td>
</tr>
<tr>
<td style="text-align:left">数字类型</td>
<td style="text-align:left">number</td>
<td style="text-align:left">双精度 64 位浮点值。它可以用来表示整数和分数。<br>let binaryLiteral: number = 0b1010; // 二进制<br/> let octalLiteral: number = 0o744;    // 八进制<br/> let decLiteral: number = 6;    // 十进制<br/> let hexLiteral: number = 0xf00d;    // 十六进制</td>
</tr>
<tr>
<td style="text-align:left">字符串类型</td>
<td style="text-align:left">string</td>
<td style="text-align:left">一个字符系列，使用单引号（<strong>‘</strong>）或双引号（<strong>“</strong>）来表示字符串类型。反引号（<strong>`</strong>）来定义多行文本和内嵌表达式。<br/>let name: string = “Runoob”; <br/>let years: number = 5;<br/> let words: string = “您好，今年是 ${ name } 发布 ${ years + 1} 周年”;</td>
</tr>
<tr>
<td style="text-align:left">布尔类型</td>
<td style="text-align:left">boolean</td>
<td style="text-align:left">表示逻辑值：true 和 false。<br/><code>let flag: boolean = true;</code></td>
</tr>
<tr>
<td style="text-align:left">数组类型</td>
<td style="text-align:left">无</td>
<td style="text-align:left">声明变量为数组。<br/><code>// 在元素类型后面加上[] let arr: number[] = [1, 2]; // 或者使用数组泛型 let arr: Array = [1, 2];</code></td>
</tr>
<tr>
<td style="text-align:left">元组</td>
<td style="text-align:left">无</td>
<td style="text-align:left">元组类型用来表示已知元素数量和类型的数组，各元素的类型不必相同，对应位置的类型需要相同。<code>let x: [string, number]; x = [&#39;Runoob&#39;, 1];    // 运行正常 x = [1, &#39;Runoob&#39;];    // 报错 console.log(x[0]);    // 输出 Runoob</code></td>
</tr>
<tr>
<td style="text-align:left">枚举</td>
<td style="text-align:left">enum</td>
<td style="text-align:left">枚举类型用于定义数值集合。<code>enum Color {Red, Green, Blue}; let c: Color = Color.Blue; console.log(c);    // 输出 2</code></td>
</tr>
<tr>
<td style="text-align:left">void</td>
<td style="text-align:left">void</td>
<td style="text-align:left">用于标识方法返回值的类型，表示该方法没有返回值。<code>function hello(): void {    alert(&quot;Hello Runoob&quot;); }</code></td>
</tr>
<tr>
<td style="text-align:left">null</td>
<td style="text-align:left">null</td>
<td style="text-align:left">表示对象值缺失。</td>
</tr>
<tr>
<td style="text-align:left">undefined</td>
<td style="text-align:left">undefined</td>
<td style="text-align:left">用于初始化变量为一个未定义的值</td>
</tr>
<tr>
<td style="text-align:left">never</td>
<td style="text-align:left">never</td>
<td style="text-align:left">never 是其它类型（包括 null 和 undefined）的子类型，代表从不会出现的值。</td>
</tr>
</tbody>
</table>
</div>
<p>注意：**TypeScript 和 JavaScript 没有整数类型。</p>
<ol>
<li><p>Any类型</p>
<blockquote>
<p>任意值是 TypeScript 针对编程时类型不明确的变量使用的一种数据类型，它常用于以下三种情况。</p>
</blockquote>
<ul>
<li><p>变量的值会动态改变时，比如来自用户的输入，任意值类型可以让这些变量跳过编译阶段的类型检查</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: <span class="built_in">any</span> = <span class="number">1</span>;    <span class="comment">// 数字类型</span></span><br><span class="line">x = <span class="string">'I am who I am'</span>;    <span class="comment">// 字符串类型</span></span><br><span class="line">x = <span class="literal">false</span>;    <span class="comment">// 布尔类型</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>改写现有代码时，任意值允许在编译时可选择地包含或移除类型检查</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: <span class="built_in">any</span> = <span class="number">4</span>;</span><br><span class="line">x.ifItExists();    <span class="comment">// 正确，ifItExists方法在运行时可能存在，但这里并不会检查</span></span><br><span class="line">x.toFixed();    <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>定义存储各种类型数据的数组时</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> arrayList: <span class="built_in">any</span>[] = [<span class="number">1</span>, <span class="literal">false</span>, <span class="string">'fine'</span>];</span><br><span class="line">arrayList[<span class="number">1</span>] = <span class="number">100</span>;</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p>Null 和 Undefined</p>
<p>null是一个只有一个值的特殊类型。表示一个空对象引用。</p>
<p>用 typeof 检测 null 返回是 object。</p>
<p>在 JavaScript 中, undefined 是一个没有设置值的变量。</p>
<p>typeof 一个没有值的变量会返回 undefined。</p>
<p>Null 和 Undefined 是其他任何类型（包括 void）的子类型，可以赋值给其它类型，如数字类型，此时，赋值后的类型会变成 null 或 undefined。而在TypeScript中启用严格的空校验（—strictNullChecks）特性，就可以使得null 和 undefined 只能被赋值给 void 或本身对应的类型，示例代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用 --strictNullChecks</span></span><br><span class="line"><span class="keyword">let</span> x: <span class="built_in">number</span>;</span><br><span class="line">x = <span class="number">1</span>; <span class="comment">// 运行正确</span></span><br><span class="line">x = <span class="literal">undefined</span>;    <span class="comment">// 运行错误</span></span><br><span class="line">x = <span class="literal">null</span>;    <span class="comment">// 运行错误</span></span><br></pre></td></tr></table></figure>
<p>上面的例子中变量 x 只能是数字类型。如果一个类型可能出现 null 或 undefined， 可以用 | 来支持多种类型，示例代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 启用 --strictNullChecks</span></span><br><span class="line"><span class="keyword">let</span> x: <span class="built_in">number</span> | <span class="literal">null</span> | <span class="literal">undefined</span>;</span><br><span class="line">x = <span class="number">1</span>; <span class="comment">// 运行正确</span></span><br><span class="line">x = <span class="literal">undefined</span>;    <span class="comment">// 运行正确</span></span><br><span class="line">x = <span class="literal">null</span>;    <span class="comment">// 运行正确</span></span><br></pre></td></tr></table></figure>
</li>
<li><p>never类型</p>
<p>never 是其它类型（包括 null 和 undefined）的子类型，代表从不会出现的值。</p>
<p>这意味着声明为 never 类型的变量只能被 never 类型所赋值，在函数中它通常表现为抛出异常或无法执行到终止点（例如无限循环），示例代码如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> x: never;</span><br><span class="line"><span class="keyword">let</span> y: <span class="built_in">number</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行错误，数字类型不能转为 never 类型</span></span><br><span class="line">x = <span class="number">123</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 运行正确，never 类型可以赋值给 never类型</span></span><br><span class="line">x = <span class="function">(<span class="params">(<span class="params"></span>)=&gt;&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="params">'exception'</span>)&#125;</span>)<span class="params">()</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 运行正确，<span class="params">never</span> 类型可以赋值给 数字类型</span></span><br><span class="line"><span class="function"><span class="params">y</span> = (<span class="params">(<span class="params"></span>)=&gt;&#123; <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="params">'exception'</span>)&#125;</span>)<span class="params">()</span>;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 返回值为 <span class="params">never</span> 的函数可以是抛出异常的情况</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">error</span>(<span class="params">message: <span class="built_in">string</span></span>): <span class="params">never</span> &#123;</span></span><br><span class="line"><span class="function">    <span class="params">throw</span> <span class="params">new</span> <span class="params">Error</span>(<span class="params">message</span>);</span></span><br><span class="line"><span class="function">&#125;</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">// 返回值为 <span class="params">never</span> 的函数可以是无法被执行到的终止点的情况</span></span><br><span class="line"><span class="function"><span class="params">function</span> <span class="params">loop</span><span class="params">()</span>: <span class="params">never</span> &#123;</span></span><br><span class="line"><span class="function">    <span class="params">while</span> (<span class="params"><span class="literal">true</span></span>) &#123;&#125;</span></span><br><span class="line"><span class="function">&#125;</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<h2 id="变量声明"><a href="#变量声明" class="headerlink" title="变量声明"></a>变量声明</h2><blockquote>
<p>变量是一种使用方便的占位符，用于引用计算机内存地址。</p>
</blockquote>
<p>TypeScript 变量的命名规则：</p>
<ul>
<li>变量名称可以包含数字和字母。</li>
<li>除了下划线 <strong>_</strong> 和美元 <strong>$</strong> 符号外，不能包含其他特殊字符，包括空格。</li>
<li>变量名不能以数字开头。</li>
</ul>
<p>变量使用前必须先声明，我们可以使用 var 来声明变量。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> [变量名] : [类型] = 值;</span><br><span class="line"><span class="comment">// 声明变量的类型，但没有初始值，变量值会设置为 undefined：</span></span><br><span class="line"><span class="keyword">var</span> [变量名] : [类型];</span><br><span class="line"><span class="comment">// 声明变量没有设置类型和初始值，类型可以是任意类型，默认初始值为 undefined：</span></span><br><span class="line"><span class="keyword">var</span> [变量名];</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong>变量不要使用 name 否则会与 DOM 中的全局 window 对象下的 name 属性出现了重名。</p>
<p>TypeScript 遵循强类型，如果将不同的类型赋值给变量会编译错误，如下实例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num:<span class="built_in">number</span> = <span class="string">"hello"</span>     <span class="comment">// 这个代码会编译错误</span></span><br></pre></td></tr></table></figure>
<p>类型断言可以用来手动指定一个值的类型，即允许变量从一种类型更改为另一种类型。</p>
<p>语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&lt;类型&gt;值</span><br></pre></td></tr></table></figure>
<p>或:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">值 as 类型</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">'1'</span> </span><br><span class="line"><span class="keyword">var</span> str2:<span class="built_in">number</span> = &lt;<span class="built_in">number</span>&gt; &lt;<span class="built_in">any</span>&gt; str   <span class="comment">//str、str2 是 string 类型</span></span><br><span class="line"><span class="built_in">console</span>.log(str2)</span><br></pre></td></tr></table></figure>
<p>当类型没有给出时，TypeScript 编译器利用类型推断来推断类型。</p>
<p>如果由于缺乏声明而不能推断出类型，那么它的类型被视作默认的动态 any 类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> num = <span class="number">2</span>;    <span class="comment">// 类型推断为 number</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"num 变量的值为 "</span>+num); </span><br><span class="line">num = <span class="string">"12"</span>;    <span class="comment">// 编译错误</span></span><br><span class="line"><span class="built_in">console</span>.log(num);</span><br></pre></td></tr></table></figure>
<p>变量作用域指定了变量定义的位置。</p>
<p>程序中变量的可用性由变量作用域决定。</p>
<p>TypeScript 有以下几种作用域：</p>
<ul>
<li><strong>全局作用域</strong> − 全局变量定义在程序结构的外部，它可以在你代码的任何位置使用。</li>
<li><strong>类作用域</strong> − 这个变量也可以称为 <strong>字段</strong>。类变量声明在一个类里头，但在类的方法外面。 该变量可以通过类的对象来访问。类变量也可以是静态的，静态的变量可以通过类名直接访问。</li>
<li><strong>局部作用域</strong> − 局部变量，局部变量只能在声明它的一个代码块（如：方法）中使用。</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global_num = <span class="number">12</span>          <span class="comment">// 全局变量</span></span><br><span class="line"><span class="keyword">class</span> Numbers &#123; </span><br><span class="line">   num_val = <span class="number">13</span>;             <span class="comment">// 实例变量</span></span><br><span class="line">   <span class="keyword">static</span> sval = <span class="number">10</span>;         <span class="comment">// 静态变量</span></span><br><span class="line">   </span><br><span class="line">   storeNum():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="keyword">var</span> local_num = <span class="number">14</span>;    <span class="comment">// 局部变量</span></span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"全局变量为: "</span>+global_num)  </span><br><span class="line"><span class="built_in">console</span>.log(Numbers.sval)   <span class="comment">// 静态变量</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Numbers(); </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"实例变量: "</span>+obj.num_val)</span><br></pre></td></tr></table></figure>
<p>上面的代码使用tsc命令编译为JavaScript代码为：</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global_num = <span class="number">12</span>; <span class="comment">// 全局变量</span></span><br><span class="line"><span class="keyword">var</span> Numbers = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Numbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.num_val = <span class="number">13</span>; <span class="comment">// 实例变量</span></span><br><span class="line">    &#125;</span><br><span class="line">    Numbers.prototype.storeNum = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> local_num = <span class="number">14</span>; <span class="comment">// 局部变量</span></span><br><span class="line">    &#125;;</span><br><span class="line">    Numbers.sval = <span class="number">10</span>; <span class="comment">// 静态变量</span></span><br><span class="line">    <span class="keyword">return</span> Numbers;</span><br><span class="line">&#125;());</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"全局变量为: "</span> + global_num);</span><br><span class="line"><span class="built_in">console</span>.log(Numbers.sval); <span class="comment">// 静态变量</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Numbers();</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"实例变量: "</span> + obj.num_val);</span><br></pre></td></tr></table></figure>
<h2 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h2><ol>
<li>算术运算符</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">例子</th>
<th style="text-align:left">x 运算结果</th>
<th style="text-align:left">y 运算结果</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">+</td>
<td style="text-align:left">加法</td>
<td style="text-align:left">x=y+2</td>
<td style="text-align:left">7</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">-</td>
<td style="text-align:left">减法</td>
<td style="text-align:left">x=y-2</td>
<td style="text-align:left">3</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">*</td>
<td style="text-align:left">乘法</td>
<td style="text-align:left">x=y*2</td>
<td style="text-align:left">10</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">/</td>
<td style="text-align:left">除法</td>
<td style="text-align:left">x=y/2</td>
<td style="text-align:left">2.5</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">%</td>
<td style="text-align:left">取模（余数）</td>
<td style="text-align:left">x=y%2</td>
<td style="text-align:left">1</td>
<td style="text-align:left">5</td>
</tr>
<tr>
<td style="text-align:left">++</td>
<td style="text-align:left">自增</td>
<td style="text-align:left">x=++y</td>
<td style="text-align:left">6</td>
<td style="text-align:left">6</td>
</tr>
<tr>
<td style="text-align:left">x=y++</td>
<td style="text-align:left">5</td>
<td style="text-align:left">6</td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">—</td>
<td style="text-align:left">自减</td>
<td style="text-align:left">x=—y</td>
<td style="text-align:left">4</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">x=y—</td>
<td style="text-align:left">5</td>
<td style="text-align:left">4</td>
<td style="text-align:left"></td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>关系运算符</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">比较</th>
<th style="text-align:left">返回值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">==</td>
<td style="text-align:left">等于</td>
<td style="text-align:left">x==8</td>
<td style="text-align:left"><em>false</em></td>
</tr>
<tr>
<td style="text-align:left">x==5</td>
<td style="text-align:left"><em>true</em></td>
<td style="text-align:left"></td>
<td style="text-align:left"></td>
</tr>
<tr>
<td style="text-align:left">!=</td>
<td style="text-align:left">不等于</td>
<td style="text-align:left">x!=8</td>
<td style="text-align:left"><em>true</em></td>
</tr>
<tr>
<td style="text-align:left">&gt;</td>
<td style="text-align:left">大于</td>
<td style="text-align:left">x&gt;8</td>
<td style="text-align:left"><em>false</em></td>
</tr>
<tr>
<td style="text-align:left">&lt;</td>
<td style="text-align:left">小于</td>
<td style="text-align:left">x&lt;8</td>
<td style="text-align:left"><em>true</em></td>
</tr>
<tr>
<td style="text-align:left">&gt;=</td>
<td style="text-align:left">大于或等于</td>
<td style="text-align:left">x&gt;=8</td>
<td style="text-align:left"><em>false</em></td>
</tr>
<tr>
<td style="text-align:left">&lt;=</td>
<td style="text-align:left">小于或等于</td>
<td style="text-align:left">x&lt;=8</td>
<td style="text-align:left"><em>true</em></td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>逻辑运算符</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">例子</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&amp;&amp;</td>
<td style="text-align:left">and</td>
<td style="text-align:left">(x &lt; 10 &amp;&amp; y &gt; 1) 为 true</td>
</tr>
<tr>
<td style="text-align:left">\</td>
<td style="text-align:left">\</td>
<td style="text-align:left"></td>
<td>or</td>
<td>(x==5 \</td>
<td>\</td>
<td>y==5) 为 false</td>
</tr>
<tr>
<td style="text-align:left">!</td>
<td style="text-align:left">not</td>
<td style="text-align:left">!(x==y) 为 true</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><p>短路运算符（&amp;&amp; 和 ||）</p>
<p>&amp;&amp; 与 || 运算符可用于组合表达式。 &amp;&amp; 运算符只有在左右两个表达式都为 true 时才返回 true。</p>
</li>
<li><p>位运算符</p>
</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">描述</th>
<th style="text-align:left">例子</th>
<th style="text-align:left">类似于</th>
<th style="text-align:left">结果</th>
<th style="text-align:left">十进制</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">&amp;</td>
<td style="text-align:left">AND，按位与处理两个长度相同的二进制数，两个相应的二进位都为 1，该位的结果值才为 1，否则为 0。</td>
<td style="text-align:left">x = 5 &amp; 1</td>
<td style="text-align:left">0101 &amp; 0001</td>
<td style="text-align:left">0001</td>
<td style="text-align:left">1</td>
</tr>
<tr>
<td style="text-align:left">\</td>
<td style="text-align:left"></td>
<td style="text-align:left">OR，按位或处理两个长度相同的二进制数，两个相应的二进位中只要有一个为 1，该位的结果值为 1。</td>
<td style="text-align:left">x = 5 \</td>
<td style="text-align:left">1</td>
<td style="text-align:left">0101 \</td>
<td>0001</td>
<td>0101</td>
<td>5</td>
</tr>
<tr>
<td style="text-align:left">~</td>
<td style="text-align:left">取反，取反是一元运算符，对一个二进制数的每一位执行逻辑反操作。使数字 1 成为 0，0 成为 1。</td>
<td style="text-align:left">x = ~ 5</td>
<td style="text-align:left">~0101</td>
<td style="text-align:left">1010</td>
<td style="text-align:left">-6</td>
</tr>
<tr>
<td style="text-align:left">^</td>
<td style="text-align:left">异或，按位异或运算，对等长二进制模式按位或二进制数的每一位执行逻辑异按位或操作。操作的结果是如果某位不同则该位为 1，否则该位为 0。</td>
<td style="text-align:left">x = 5 ^ 1</td>
<td style="text-align:left">0101 ^ 0001</td>
<td style="text-align:left">0100</td>
<td style="text-align:left">4</td>
</tr>
<tr>
<td style="text-align:left">&lt;&lt;</td>
<td style="text-align:left">左移，把 &lt;&lt; 左边的运算数的各二进位全部左移若干位，由 &lt;&lt; 右边的数指定移动的位数，高位丢弃，低位补 0。</td>
<td style="text-align:left">x = 5 &lt;&lt; 1</td>
<td style="text-align:left">0101 &lt;&lt; 1</td>
<td style="text-align:left">1010</td>
<td style="text-align:left">10</td>
</tr>
<tr>
<td style="text-align:left">&gt;&gt;</td>
<td style="text-align:left">右移，把 &gt;&gt; 左边的运算数的各二进位全部右移若干位，&gt;&gt; 右边的数指定移动的位数。</td>
<td style="text-align:left">x = 5 &gt;&gt; 1</td>
<td style="text-align:left">0101 &gt;&gt; 1</td>
<td style="text-align:left">0010</td>
<td style="text-align:left">2</td>
</tr>
<tr>
<td style="text-align:left">&gt;&gt;&gt;</td>
<td style="text-align:left">无符号右移，与有符号右移位类似，除了左边一律使用0 补位。</td>
<td style="text-align:left">x = 2 &gt;&gt;&gt; 1</td>
<td style="text-align:left">0010 &gt;&gt;&gt; 1</td>
<td style="text-align:left">0001</td>
<td style="text-align:left">1</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li>赋值运算符</li>
</ol>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:left">运算符</th>
<th style="text-align:left">例子</th>
<th style="text-align:left">实例</th>
<th style="text-align:left">x 值</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:left">= (赋值)</td>
<td style="text-align:left">x = y</td>
<td style="text-align:left">x = y</td>
<td style="text-align:left">x = 5</td>
</tr>
<tr>
<td style="text-align:left">+= (先进行加运算后赋值)</td>
<td style="text-align:left">x += y</td>
<td style="text-align:left">x = x + y</td>
<td style="text-align:left">x = 15</td>
</tr>
<tr>
<td style="text-align:left">-= (先进行减运算后赋值)</td>
<td style="text-align:left">x -= y</td>
<td style="text-align:left">x = x - y</td>
<td style="text-align:left">x = 5</td>
</tr>
<tr>
<td style="text-align:left">*= (先进行乘运算后赋值)</td>
<td style="text-align:left">x *= y</td>
<td style="text-align:left">x = x * y</td>
<td style="text-align:left">x = 50</td>
</tr>
<tr>
<td style="text-align:left">/= (先进行除运算后赋值)</td>
<td style="text-align:left">x /= y</td>
<td style="text-align:left">x = x / y</td>
<td style="text-align:left">x = 2</td>
</tr>
</tbody>
</table>
</div>
<ol>
<li><p>三元运算符 (?)</p>
<p>三元运算有 3 个操作数，并且需要判断布尔表达式的值。该运算符的主要是决定哪个值应该赋值给变量。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Test ? expr1 : expr2</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>类型运算符</p>
<p>typeof 是一元运算符，返回操作数的数据类型。</p>
<p>instanceof 运算符用于判断对象是否为指定的类型</p>
</li>
<li><p>其他运算符</p>
<p>负号运算符(-)：更改操作数的符号</p>
<p>字符串运算符: 连接运算符 (+)运算符可以拼接两个字符串</p>
</li>
</ol>
<h2 id="条件和循环语句"><a href="#条件和循环语句" class="headerlink" title="条件和循环语句"></a>条件和循环语句</h2><p>在 TypeScript 中，我们可使用以下条件语句：</p>
<ul>
<li><strong>if 语句</strong> - 只有当指定条件为 true 时，使用该语句来执行代码</li>
<li><strong>if…else 语句</strong> - 当条件为 true 时执行代码，当条件为 false 时执行其他代码</li>
<li><strong>if…else if….else 语句</strong>- 使用该语句来选择多个代码块之一来执行</li>
<li><strong>switch 语句</strong> - 使用该语句来选择多个代码块之一来执行</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(boolean_expression)&#123;</span><br><span class="line">    <span class="comment">// 在布尔表达式 boolean_expression 为 true 执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(boolean_expression)&#123;</span><br><span class="line">   <span class="comment">// 在布尔表达式 boolean_expression 为 true 执行</span></span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">   <span class="comment">// 在布尔表达式 boolean_expression 为 false 执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(boolean_expression <span class="number">1</span>)&#123;</span><br><span class="line">    <span class="comment">// 在布尔表达式 boolean_expression 1 为 true 执行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>( boolean_expression <span class="number">2</span>)&#123;</span><br><span class="line">    <span class="comment">// 在布尔表达式 boolean_expression 2 为 true 执行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(( boolean_expression <span class="number">3</span>)&#123;</span><br><span class="line">    <span class="comment">// 在布尔表达式 boolean_expression 3 为 true 执行</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="comment">// 布尔表达式的条件都为 false 时执行</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">switch</span>(expression)&#123;</span><br><span class="line">    <span class="keyword">case</span> constant-expression  :</span><br><span class="line">       statement(s);</span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">/* 可选的 */</span></span><br><span class="line">    <span class="keyword">case</span> constant-expression  :</span><br><span class="line">       statement(s);</span><br><span class="line">       <span class="keyword">break</span>; <span class="comment">/* 可选的 */</span></span><br><span class="line">  </span><br><span class="line">    <span class="comment">/* 您可以有任意数量的 case 语句 */</span></span><br><span class="line">    <span class="keyword">default</span> : <span class="comment">/* 可选的 */</span></span><br><span class="line">       statement(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p><strong>switch</strong> 语句必须遵循下面的规则：</p>
<ul>
<li><strong>switch</strong> 语句中的 <strong>expression</strong> 是一个常量表达式，必须是一个整型或枚举类型。</li>
<li>在一个 switch 中可以有任意数量的 case 语句。每个 case 后跟一个要比较的值和一个冒号。</li>
<li>case 的 <strong>constant-expression</strong> 必须与 switch 中的变量具有相同的数据类型，且必须是一个常量或字面量。</li>
<li>当被测试的变量等于 case 中的常量时，case 后跟的语句将被执行，直到遇到 <strong>break</strong> 语句为止。</li>
<li>当遇到 <strong>break</strong> 语句时，switch 终止，控制流将跳转到 switch 语句后的下一行。</li>
<li>不是每一个 case 都需要包含 <strong>break</strong>。如果 case 语句不包含 <strong>break</strong>，控制流将会 <em>继续</em> 后续的 case，直到遇到 break 为止。</li>
<li>一个 <strong>switch</strong> 语句可以有一个可选的 <strong>default</strong> case，出现在 switch 的结尾。default case 可用于在上面所有 case 都不为真时执行一个任务。default case 中的 <strong>break</strong> 语句不是必需的。</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> ( init; condition; increment )&#123;</span><br><span class="line">    statement(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ol>
<li><strong>init</strong> 会首先被执行，且只会执行一次。这一步允许您声明并初始化任何循环控制变量。您也可以不在这里写任何语句，只要有一个分号出现即可。</li>
<li>接下来，会判断 <strong>condition</strong>。如果为 true，则执行循环主体。如果为 false，则不执行循环主体，且控制流会跳转到紧接着 for 循环的下一条语句。</li>
<li>在执行完 for 循环主体后，控制流会跳回上面的 <strong>increment</strong> 语句。该语句允许您更新循环控制变量。该语句可以留空，只要在条件后有一个分号出现即可。</li>
<li>条件再次被判断。如果为 true，则执行循环，这个过程会不断重复（循环主体，然后增加步值，再然后重新判断条件）。在条件变为 false 时，for 循环终止。</li>
</ol>
<p>for…in 语句用于一组值的集合或列表进行迭代输出。val 需要为 string 或 any 类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">var</span> val <span class="keyword">in</span> list) &#123; </span><br><span class="line">    <span class="comment">//语句 </span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>for…of 语句创建一个循环来迭代可迭代的对象。在 ES6 中引入的 for…of 循环，以替代 for…in 和 forEach() ，并支持新的迭代协议。for…of 允许你遍历 Arrays（数组）, Strings（字符串）, Maps（映射）, Sets（集合）等可迭代的数据结构等。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> someArray = [<span class="number">1</span>, <span class="string">"string"</span>, <span class="literal">false</span>];</span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> entry of someArray) &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(entry); <span class="comment">// 1, "string", false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>forEach、every 和 some 是 JavaScript 的循环语法，TypeScript 作为 JavaScript 的语法超集，当然默认也是支持的。</p>
<p>因为 forEach 在 iteration 中是无法返回的，所以可以使用 every 和 some 来取代 forEach。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">let list &#x3D; [4, 5, 6];</span><br><span class="line">list.forEach((val, idx, array) &#x3D;&gt; &#123;</span><br><span class="line">    &#x2F;&#x2F; val: 当前值</span><br><span class="line">    &#x2F;&#x2F; idx：当前index</span><br><span class="line">    &#x2F;&#x2F; array: Array</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> list = [<span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>];</span><br><span class="line">list.every(<span class="function">(<span class="params">val, idx, array</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// val: 当前值</span></span><br><span class="line">    <span class="comment">// idx：当前index</span></span><br><span class="line">    <span class="comment">// array: Array</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">true</span>; <span class="comment">// Continues</span></span><br><span class="line">    <span class="comment">// Return false will quit the iteration</span></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">while</span>(condition)</span><br><span class="line">&#123;</span><br><span class="line">   statement(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">do</span></span><br><span class="line">&#123;</span><br><span class="line">   statement(s);</span><br><span class="line">&#125;<span class="keyword">while</span>( condition );</span><br></pre></td></tr></table></figure>
<p><strong>break</strong> 语句有以下两种用法：</p>
<ol>
<li>当 <strong>break</strong> 语句出现在一个循环内时，循环会立即终止，且程序流将继续执行紧接着循环的下一条语句。</li>
<li>它可用于终止 <strong>switch</strong> 语句中的一个 case。</li>
</ol>
<p><strong>ontinue</strong> 语句有点像 <strong>break</strong> 语句。但它不是强制终止，continue 会跳过当前循环中的代码，强迫开始下一次循环。</p>
<p>对于 <strong>for</strong> 循环，<strong>continue</strong> 语句执行后自增语句仍然会执行。对于 <strong>while</strong> 和 <strong>do…while</strong> 循环，<strong>continue</strong> 语句重新执行条件判断语句。</p>
<h2 id="函数"><a href="#函数" class="headerlink" title="函数"></a>函数</h2><p>函数：一组一起执行一个任务的语句。</p>
<p>函数声明告诉编译器函数的名称、返回类型和参数。函数定义提供了函数的实际主体。</p>
<ol>
<li><p>函数定义</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">function_name</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    <span class="comment">// 执行代码</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>调用函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">function_name()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>函数返回值</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">function_name</span>(<span class="params"></span>):<span class="title">return_type</span> </span>&#123; </span><br><span class="line">    <span class="comment">// 语句</span></span><br><span class="line">    <span class="keyword">return</span> value; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>return_type 是返回值的类型。</li>
<li>return 关键词后跟着要返回的结果。</li>
<li>一个函数只能有一个 return 语句。</li>
<li>返回值的类型需要与函数定义的返回类型(return_type)一致。</li>
</ul>
<p>实例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>):<span class="title">string</span> </span>&#123; <span class="comment">// 返回一个字符串</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">caller</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> msg = greet() <span class="comment">// 调用 greet() 函数 </span></span><br><span class="line">    <span class="built_in">console</span>.log(msg) </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line">caller()</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 函数定义</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">greet</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"Hello World"</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">caller</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> msg = greet(); <span class="comment">// 调用 greet() 函数 </span></span><br><span class="line">    <span class="built_in">console</span>.log(msg);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// 调用函数</span></span><br><span class="line">caller();</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>带参数函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">func_name</span>(<span class="params"> param1 [:datatype], param2 [:datatype]</span>) </span>&#123;   </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>param1、param2 为参数名。</li>
<li>datatype 为参数类型。</li>
</ul>
</li>
<li><p>可选参数和默认参数</p>
<p>可选参数：可选参数使用问号标识 ？。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildName</span>(<span class="params">firstName: <span class="built_in">string</span>, lastName?: <span class="built_in">string</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (lastName)</span><br><span class="line">        <span class="keyword">return</span> firstName + <span class="string">" "</span> + lastName;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> firstName;</span><br><span class="line">&#125;</span><br><span class="line"> </span><br><span class="line"><span class="keyword">let</span> result1 = buildName(<span class="string">"Bob"</span>);  <span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">let</span> result2 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>, <span class="string">"Sr."</span>);  <span class="comment">// 错误，参数太多了</span></span><br><span class="line"><span class="keyword">let</span> result3 = buildName(<span class="string">"Bob"</span>, <span class="string">"Adams"</span>);  <span class="comment">// 正确</span></span><br></pre></td></tr></table></figure>
<p>可选参数必须跟在必需参数后面。</p>
<p>设置参数的默认值</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">function_name</span>(<span class="params">param1[:<span class="keyword">type</span>],param2[:<span class="keyword">type</span>] = default_value</span>) </span>&#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>注意：参数不能同时设置为可选和默认。</p>
<p>实例</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">function calculate_discount(price:number,rate:number &#x3D; 0.50) &#123; </span><br><span class="line">    var discount &#x3D; price * rate; </span><br><span class="line">    console.log(&quot;计算结果: &quot;,discount); </span><br><span class="line">&#125; </span><br><span class="line">calculate_discount(1000) </span><br><span class="line">calculate_discount(1000,0.30)</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">calculate_discount</span>(<span class="params">price, rate</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (rate === <span class="keyword">void</span> <span class="number">0</span>) &#123; rate = <span class="number">0.50</span>; &#125;</span><br><span class="line">    <span class="keyword">var</span> discount = price * rate;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"计算结果: "</span>, discount);</span><br><span class="line">&#125;</span><br><span class="line">calculate_discount(<span class="number">1000</span>);</span><br><span class="line">calculate_discount(<span class="number">1000</span>, <span class="number">0.30</span>);</span><br></pre></td></tr></table></figure>
</li>
<li><p>剩余参数</p>
<p>剩余参数语法允许我们将一个不确定数量的参数作为一个数组传入。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">buildName</span>(<span class="params">firstName: <span class="built_in">string</span>, ...restOfName: <span class="built_in">string</span>[]</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> firstName + <span class="string">" "</span> + restOfName.join(<span class="string">" "</span>);</span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">let</span> employeeName = buildName(<span class="string">"Joseph"</span>, <span class="string">"Samuel"</span>, <span class="string">"Lucas"</span>, <span class="string">"MacKinzie"</span>);</span><br></pre></td></tr></table></figure>
<p>函数的最后一个命名参数 restOfName 以 … 为前缀，它将成为一个由剩余参数组成的数组，索引值从0（包括）到 restOfName.length（不包括）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNumbers</span>(<span class="params">...nums:<span class="built_in">number</span>[]</span>) </span>&#123;  </span><br><span class="line">    <span class="keyword">var</span> i;   </span><br><span class="line">    <span class="keyword">var</span> sum:<span class="built_in">number</span> = <span class="number">0</span>; </span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;nums.length;i++) &#123; </span><br><span class="line">       sum = sum + nums[i]; </span><br><span class="line">    &#125; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"和为："</span>,sum) </span><br><span class="line"> &#125; </span><br><span class="line"> addNumbers(<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>) </span><br><span class="line"> addNumbers(<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>,<span class="number">10</span>)</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addNumbers</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> nums = [];</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">var</span> _i = <span class="number">0</span>; _i &lt; <span class="built_in">arguments</span>.length; _i++) &#123;</span><br><span class="line">        nums[_i] = <span class="built_in">arguments</span>[_i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">var</span> i;</span><br><span class="line">    <span class="keyword">var</span> sum = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">for</span> (i = <span class="number">0</span>; i &lt; nums.length; i++) &#123;</span><br><span class="line">        sum = sum + nums[i];</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"和为："</span>, sum);</span><br><span class="line">&#125;</span><br><span class="line">addNumbers(<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>);</span><br><span class="line">addNumbers(<span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>, <span class="number">10</span>);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>匿名参数</p>
<p>匿名函数是一个没有函数名的函数。</p>
<p>匿名函数在程序运行时动态声明，除了没有函数名外，其他的与标准函数一样。</p>
<p>匿名函数赋值给一个变量，这种表达式就成为函数表达式。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="function"><span class="keyword">function</span>(<span class="params"> [<span class="built_in">arguments</span>] </span>) </span>&#123; ... &#125;</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msg = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello world"</span>;  </span><br><span class="line">&#125; </span><br><span class="line"><span class="built_in">console</span>.log(msg())</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> msg = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">"hello world"</span>;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(msg());</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="function"><span class="keyword">function</span>(<span class="params">a:<span class="built_in">number</span>,b:<span class="built_in">number</span></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">return</span> a*b;  </span><br><span class="line">&#125;; </span><br><span class="line"><span class="built_in">console</span>.log(res(<span class="number">12</span>,<span class="number">2</span>))</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> a * b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(res(<span class="number">12</span>, <span class="number">2</span>));</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>匿名函数自调用</p>
<p>匿名函数自调用在函数后使用 () 即可：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">"Hello!!"</span>;   </span><br><span class="line">    <span class="built_in">console</span>.log(x)     </span><br><span class="line"> &#125;)()</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> x = <span class="string">"Hello!!"</span>;   </span><br><span class="line">    <span class="built_in">console</span>.log(x)    </span><br><span class="line">&#125;)()</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>构造函数</p>
<p>TypeScript 也支持使用 JavaScript 内置的构造函数 Function() 来定义函数：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> res = <span class="keyword">new</span> <span class="built_in">Function</span>( [<span class="built_in">arguments</span>] ) &#123; ... &#125;)</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunction = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"return a * b"</span>); </span><br><span class="line"><span class="keyword">var</span> x = myFunction(<span class="number">4</span>, <span class="number">3</span>); </span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> myFunction = <span class="keyword">new</span> <span class="built_in">Function</span>(<span class="string">"a"</span>, <span class="string">"b"</span>, <span class="string">"return a * b"</span>); </span><br><span class="line"><span class="keyword">var</span> x = myFunction(<span class="number">4</span>, <span class="number">3</span>); </span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>递归函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params"><span class="built_in">number</span></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">number</span> &lt;= <span class="number">0</span>) &#123;         <span class="comment">// 停止执行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>; </span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;     </span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">number</span> * factorial(<span class="built_in">number</span> - <span class="number">1</span>));     <span class="comment">// 调用自身</span></span><br><span class="line">    &#125; </span><br><span class="line">&#125;; </span><br><span class="line"><span class="built_in">console</span>.log(factorial(<span class="number">6</span>));      <span class="comment">// 输出 720</span></span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">factorial</span>(<span class="params">number</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (number &lt;= <span class="number">0</span>) &#123; <span class="comment">// 停止执行</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> (number * factorial(number - <span class="number">1</span>)); <span class="comment">// 调用自身</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">;</span><br><span class="line"><span class="built_in">console</span>.log(factorial(<span class="number">6</span>)); <span class="comment">// 输出 720</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>Lambda函数</p>
<p>Lambda 函数也称之为箭头函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">( [param1, parma2,…param n] )=&gt;statement;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function">(<span class="params">x:<span class="built_in">number</span></span>)=&gt;</span><span class="number">10</span> + x </span><br><span class="line"><span class="built_in">console</span>.log(foo(<span class="number">100</span>))      <span class="comment">//输出结果为 110</span></span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> foo = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123; <span class="keyword">return</span> <span class="number">10</span> + x; &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(foo(<span class="number">100</span>)); <span class="comment">//输出结果为 110</span></span><br></pre></td></tr></table></figure>
</li>
</ol>
<ol>
<li><p>函数重载</p>
<p>重载是方法名字相同，而参数不同，返回类型可以相同也可以不同。</p>
<p>每个重载的方法（或者构造函数）都必须有一个独一无二的参数类型列表。</p>
</li>
</ol>
<h2 id="类型细节"><a href="#类型细节" class="headerlink" title="类型细节"></a>类型细节</h2><h3 id="Number"><a href="#Number" class="headerlink" title="Number"></a>Number</h3><p>Number 对象是原始数值的包装对象。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var num &#x3D; new Number(value);</span><br></pre></td></tr></table></figure>
<p><strong>注意：</strong> 如果一个参数值不能转换为一个数字将返回 NaN (非数字值)。</p>
<p>Number 对象支持的属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">属性 &amp; 描述</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center"><strong>MAX_VALUE</strong>可表示的最大的数，MAX_VALUE 属性值接近于 1.79E+308。大于 MAX_VALUE 的值代表 “Infinity”。</td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center"><strong>MIN_VALUE</strong>可表示的最小的数，即最接近 0 的正数 (实际上不会变成 0)。最大的负数是 -MIN_VALUE，MIN_VALUE 的值约为 5e-324。小于 MIN_VALUE (“underflow values”) 的值将会转换为 0。</td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center"><strong>NaN</strong>非数字值（Not-A-Number）。</td>
</tr>
<tr>
<td style="text-align:center">4.</td>
<td style="text-align:center"><strong>NEGATIVE_INFINITY</strong>负无穷大，溢出时返回该值。该值小于 MIN_VALUE。</td>
</tr>
<tr>
<td style="text-align:center">5.</td>
<td style="text-align:center"><strong>POSITIVE_INFINITY</strong>正无穷大，溢出时返回该值。该值大于 MAX_VALUE。</td>
</tr>
<tr>
<td style="text-align:center">6.</td>
<td style="text-align:center"><strong>prototype</strong>Number 对象的静态属性。使您有能力向对象添加属性和方法。</td>
</tr>
<tr>
<td style="text-align:center">7.</td>
<td style="text-align:center"><strong>constructor</strong>返回对创建此对象的 Number 函数的引用。</td>
</tr>
</tbody>
</table>
</div>
<p>Number对象 支持以下方法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">方法 &amp; 描述</th>
<th style="text-align:center">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center">toExponential()把对象的值转换为指数计数法。</td>
<td style="text-align:center"><code>//toExponential()  var num1 = 1225.30  var val = num1.toExponential();  console.log(val) // 输出： 1.2253e+3</code></td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center">toFixed()把数字转换为字符串，并对小数点指定位数。</td>
<td style="text-align:center"><code>var num3 = 177.234  console.log(&quot;num3.toFixed() 为 &quot;+num3.toFixed())    // 输出：177 console.log(&quot;num3.toFixed(2) 为 &quot;+num3.toFixed(2))  // 输出：177.23 console.log(&quot;num3.toFixed(6) 为 &quot;+num3.toFixed(6))  // 输出：177.234000</code></td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center">toLocaleString()把数字转换为字符串，使用本地数字格式顺序。</td>
<td style="text-align:center"><code>var num = new Number(177.1234);  console.log( num.toLocaleString());  // 输出：177.1234</code></td>
</tr>
<tr>
<td style="text-align:center">4.</td>
<td style="text-align:center">toPrecision()把数字格式化为指定的长度。</td>
<td style="text-align:center"><code>var num = new Number(7.123456);  console.log(num.toPrecision());  // 输出：7.123456  console.log(num.toPrecision(1)); // 输出：7 console.log(num.toPrecision(2)); // 输出：7.1</code></td>
</tr>
<tr>
<td style="text-align:center">5.</td>
<td style="text-align:center">toString()把数字转换为字符串，使用指定的基数。数字的基数是 2 ~ 36 之间的整数。若省略该参数，则使用基数 10。</td>
<td style="text-align:center"><code>var num = new Number(10);  console.log(num.toString());  // 输出10进制：10 console.log(num.toString(2)); // 输出2进制：1010 console.log(num.toString(8)); // 输出8进制：12</code></td>
</tr>
<tr>
<td style="text-align:center">6.</td>
<td style="text-align:center">valueOf()返回一个 Number 对象的原始数字值。</td>
<td style="text-align:center"><code>var num = new Number(10);  console.log(num.valueOf()); // 输出：10</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><p>String 对象用于处理文本（字符串）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> txt = <span class="keyword">new</span> <span class="built_in">String</span>(<span class="string">"string"</span>);</span><br><span class="line">或者更简单方式：</span><br><span class="line"><span class="keyword">var</span> txt = <span class="string">"string"</span>;</span><br></pre></td></tr></table></figure>
<p>String 对象支持的属性：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">属性 &amp; 描述</th>
<th style="text-align:center">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center">constructor对创建该对象的函数的引用。</td>
<td style="text-align:center"><code>var str = new String( &quot;This is string&quot; );  console.log(&quot;str.constructor is:&quot; + str.constructor)</code>输出结果：<code>str.constructor is:function String() { [native code] }</code></td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center">length返回字符串的长度。</td>
<td style="text-align:center"><code>var uname = new String(&quot;Hello World&quot;)  console.log(&quot;Length &quot;+uname.length)  // 输出 11</code></td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center">prototype允许您向对象添加属性和方法。</td>
<td style="text-align:center"><code>function employee(id:number,name:string) {     this.id = id     this.name = name  }  var emp = new employee(123,&quot;admin&quot;)  employee.prototype.email=&quot;admin@runoob.com&quot; // 添加属性 email console.log(&quot;员工号: &quot;+emp.id)  console.log(&quot;员工姓名: &quot;+emp.name)  console.log(&quot;员工邮箱: &quot;+emp.email)</code></td>
</tr>
</tbody>
</table>
</div>
<p>下表列出了 String 对象支持的方法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">方法 &amp; 描述</th>
<th style="text-align:center">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center">charAt()返回在指定位置的字符。</td>
<td style="text-align:center"><code>var str = new String(&quot;RUNOOB&quot;);  console.log(&quot;str.charAt(0) 为:&quot; + str.charAt(0)); // R console.log(&quot;str.charAt(1) 为:&quot; + str.charAt(1)); // U  console.log(&quot;str.charAt(2) 为:&quot; + str.charAt(2)); // N  console.log(&quot;str.charAt(3) 为:&quot; + str.charAt(3)); // O  console.log(&quot;str.charAt(4) 为:&quot; + str.charAt(4)); // O  console.log(&quot;str.charAt(5) 为:&quot; + str.charAt(5)); // B</code></td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center">charCodeAt()返回在指定的位置的字符的 Unicode 编码。</td>
<td style="text-align:center"><code>var str = new String(&quot;RUNOOB&quot;);  console.log(&quot;str.charCodeAt(0) 为:&quot; + str.charCodeAt(0)); // 82 console.log(&quot;str.charCodeAt(1) 为:&quot; + str.charCodeAt(1)); // 85  console.log(&quot;str.charCodeAt(2) 为:&quot; + str.charCodeAt(2)); // 78  console.log(&quot;str.charCodeAt(3) 为:&quot; + str.charCodeAt(3)); // 79  console.log(&quot;str.charCodeAt(4) 为:&quot; + str.charCodeAt(4)); // 79 console.log(&quot;str.charCodeAt(5) 为:&quot; + str.charCodeAt(5)); // 66</code></td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center">concat()连接两个或更多字符串，并返回新的字符串。</td>
<td style="text-align:center"><code>var str1 = new String( &quot;RUNOOB&quot; );  var str2 = new String( &quot;GOOGLE&quot; );  var str3 = str1.concat( str2 );  console.log(&quot;str1 + str2 : &quot;+str3) // RUNOOBGOOGLE</code></td>
</tr>
<tr>
<td style="text-align:center">4.</td>
<td style="text-align:center">indexOf()返回某个指定的字符串值在字符串中首次出现的位置。</td>
<td style="text-align:center"><code>var str1 = new String( &quot;RUNOOB&quot; );  var index = str1.indexOf( &quot;OO&quot; );  console.log(&quot;查找的字符串位置 :&quot; + index );  // 3</code></td>
</tr>
<tr>
<td style="text-align:center">5.</td>
<td style="text-align:center">lastIndexOf()从后向前搜索字符串，并从起始位置（0）开始计算返回字符串最后出现的位置。</td>
<td style="text-align:center"><code>var str1 = new String( &quot;This is string one and again string&quot; );  var index = str1.lastIndexOf( &quot;string&quot; ); console.log(&quot;lastIndexOf 查找到的最后字符串位置 :&quot; + index ); // 29     index = str1.lastIndexOf( &quot;one&quot; );  console.log(&quot;lastIndexOf 查找到的最后字符串位置 :&quot; + index ); // 15</code></td>
</tr>
<tr>
<td style="text-align:center">6.</td>
<td style="text-align:center">localeCompare()用本地特定的顺序来比较两个字符串。</td>
<td style="text-align:center"><code>var str1 = new String( &quot;This is beautiful string&quot; );   var index = str1.localeCompare( &quot;This is beautiful string&quot;);   console.log(&quot;localeCompare first :&quot; + index );  // 0</code></td>
</tr>
<tr>
<td style="text-align:center">7.</td>
<td style="text-align:center"><strong>match()</strong>查找找到一个或多个正则表达式的匹配。</td>
<td style="text-align:center"><code>var str=&quot;The rain in SPAIN stays mainly in the plain&quot;;  var n=str.match(/ain/g);  // ain,ain,ain</code></td>
</tr>
<tr>
<td style="text-align:center">8.</td>
<td style="text-align:center">replace()替换与正则表达式匹配的子串</td>
<td style="text-align:center"><code>var re = /(\w+)\s(\w+)/;  var str = &quot;zara ali&quot;;  var newstr = str.replace(re, &quot;$2, $1&quot;);  console.log(newstr); // ali, zara</code></td>
</tr>
<tr>
<td style="text-align:center">9.</td>
<td style="text-align:center">search()检索与正则表达式相匹配的值</td>
<td style="text-align:center"><code>var re = /apples/gi;  var str = &quot;Apples are round, and apples are juicy.&quot;; if (str.search(re) == -1 ) {    console.log(&quot;Does not contain Apples&quot; );  } else {    console.log(&quot;Contains Apples&quot; );  }</code></td>
</tr>
<tr>
<td style="text-align:center">10.</td>
<td style="text-align:center">slice()提取字符串的片断，并在新的字符串中返回被提取的部分。</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">11.</td>
<td style="text-align:center">split()把字符串分割为子字符串数组。</td>
<td style="text-align:center"><code>var str = &quot;Apples are round, and apples are juicy.&quot;;  var splitted = str.split(&quot; &quot;, 3);  console.log(splitted)  // [ &#39;Apples&#39;, &#39;are&#39;, &#39;round,&#39; ]</code></td>
</tr>
<tr>
<td style="text-align:center">12.</td>
<td style="text-align:center">substr()从起始索引号提取字符串中指定数目的字符。</td>
<td style="text-align:center"></td>
</tr>
<tr>
<td style="text-align:center">13.</td>
<td style="text-align:center">substring()提取字符串中两个指定的索引号之间的字符。</td>
<td style="text-align:center"><code>var str = &quot;RUNOOB GOOGLE TAOBAO FACEBOOK&quot;;  console.log(&quot;(1,2): &quot;    + str.substring(1,2));   // U console.log(&quot;(0,10): &quot;   + str.substring(0, 10)); // RUNOOB GOO console.log(&quot;(5): &quot;      + str.substring(5));     // B GOOGLE TAOBAO FACEBOOK</code></td>
</tr>
<tr>
<td style="text-align:center">14.</td>
<td style="text-align:center">toLocaleLowerCase()根据主机的语言环境把字符串转换为小写，只有几种语言（如土耳其语）具有地方特有的大小写映射。</td>
<td style="text-align:center"><code>var str = &quot;Runoob Google&quot;;  console.log(str.toLocaleLowerCase( ));  // runoob google</code></td>
</tr>
<tr>
<td style="text-align:center">15.</td>
<td style="text-align:center">toLocaleUpperCase()据主机的语言环境把字符串转换为大写，只有几种语言（如土耳其语）具有地方特有的大小写映射。</td>
<td style="text-align:center"><code>var str = &quot;Runoob Google&quot;;  console.log(str.toLocaleUpperCase( ));  // RUNOOB GOOGLE</code></td>
</tr>
<tr>
<td style="text-align:center">16.</td>
<td style="text-align:center">toLowerCase()把字符串转换为小写。</td>
<td style="text-align:center"><code>var str = &quot;Runoob Google&quot;;  console.log(str.toLowerCase( ));  // runoob google</code></td>
</tr>
<tr>
<td style="text-align:center">17.</td>
<td style="text-align:center">toString()返回字符串。</td>
<td style="text-align:center"><code>var str = &quot;Runoob&quot;;  console.log(str.toString( )); // Runoob</code></td>
</tr>
<tr>
<td style="text-align:center">18.</td>
<td style="text-align:center">toUpperCase()把字符串转换为大写。</td>
<td style="text-align:center"><code>var str = &quot;Runoob Google&quot;;  console.log(str.toUpperCase( ));  // RUNOOB GOOGLE</code></td>
</tr>
<tr>
<td style="text-align:center">19.</td>
<td style="text-align:center">valueOf()返回指定字符串对象的原始值。</td>
<td style="text-align:center"><code>var str = new String(&quot;Runoob&quot;);  console.log(str.valueOf( ));  // Runoob</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="Array"><a href="#Array" class="headerlink" title="Array"></a>Array</h3><p>数组对象是使用单独的变量名来存储一系列的值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array_name:datatype[];        <span class="comment">//声明 </span></span><br><span class="line">array_name = [val1,val2,valn..]   <span class="comment">//初始化</span></span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> numlist:<span class="built_in">number</span>[] = [<span class="number">2</span>,<span class="number">4</span>,<span class="number">6</span>,<span class="number">8</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sites:<span class="built_in">string</span>[]; </span><br><span class="line">sites = [<span class="string">"Google"</span>,<span class="string">"Runoob"</span>,<span class="string">"Taobao"</span>] </span><br><span class="line"><span class="built_in">console</span>.log(sites[<span class="number">0</span>]); </span><br><span class="line"><span class="built_in">console</span>.log(sites[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sites;</span><br><span class="line">sites = [<span class="string">"Google"</span>, <span class="string">"Runoob"</span>, <span class="string">"Taobao"</span>];</span><br><span class="line"><span class="built_in">console</span>.log(sites[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(sites[<span class="number">1</span>]);</span><br></pre></td></tr></table></figure>
<p>也可以使用 Array 对象创建数组。</p>
<p>Array 对象的构造函数接受以下两种值：</p>
<ul>
<li>表示数组大小的数值。</li>
<li>初始化的数组列表，元素使用逗号分隔值。</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr_names:<span class="built_in">number</span>[] = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="number">4</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>; i&lt;arr_names.length; i++) &#123; </span><br><span class="line">        arr_names[i] = i * <span class="number">2</span> </span><br><span class="line">        <span class="built_in">console</span>.log(arr_names[i]) </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> sites:<span class="built_in">string</span>[] = <span class="keyword">new</span> <span class="built_in">Array</span>(<span class="string">"Google"</span>,<span class="string">"Runoob"</span>,<span class="string">"Taobao"</span>,<span class="string">"Facebook"</span>) </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">var</span> i = <span class="number">0</span>;i&lt;sites.length;i++) &#123; </span><br><span class="line">        <span class="built_in">console</span>.log(sites[i]) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>数组解构</p>
<p>数组元素赋值给变量，如下所示</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr:<span class="built_in">number</span>[] = [<span class="number">12</span>,<span class="number">13</span>] </span><br><span class="line"><span class="keyword">var</span>[x,y] = arr <span class="comment">// 将数组的两个元素赋值给变量 x 和 y</span></span><br><span class="line"><span class="built_in">console</span>.log(x) </span><br><span class="line"><span class="built_in">console</span>.log(y)</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">12</span>, <span class="number">13</span>];</span><br><span class="line"><span class="keyword">var</span> x = arr[<span class="number">0</span>], y = arr[<span class="number">1</span>]; <span class="comment">// 将数组的两个元素赋值给变量 x 和 y</span></span><br><span class="line"><span class="built_in">console</span>.log(x);</span><br><span class="line"><span class="built_in">console</span>.log(y);</span><br></pre></td></tr></table></figure>
<p>数组迭代</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> j:<span class="built_in">any</span>; </span><br><span class="line"><span class="keyword">var</span> nums:<span class="built_in">number</span>[] = [<span class="number">1001</span>,<span class="number">1002</span>,<span class="number">1003</span>,<span class="number">1004</span>] </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(j <span class="keyword">in</span> nums) &#123; </span><br><span class="line">    <span class="built_in">console</span>.log(nums[j]) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>多维数组</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr_name:datatype[][]=[ [val1,val2,val3],[v1,v2,v3] ]</span><br></pre></td></tr></table></figure>
<p>常用的数组方法：</p>
<div class="table-container">
<table>
<thead>
<tr>
<th style="text-align:center">序号</th>
<th style="text-align:center">方法 &amp; 描述</th>
<th style="text-align:center">实例</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align:center">1.</td>
<td style="text-align:center">concat()连接两个或更多的数组，并返回结果。</td>
<td style="text-align:center"><code>var alpha = [&quot;a&quot;, &quot;b&quot;, &quot;c&quot;];  var numeric = [1, 2, 3]; var alphaNumeric = alpha.concat(numeric);  console.log(&quot;alphaNumeric : &quot; + alphaNumeric );    // a,b,c,1,2,3</code></td>
</tr>
<tr>
<td style="text-align:center">2.</td>
<td style="text-align:center">every()检测数值元素的每个元素是否都符合条件。</td>
<td style="text-align:center"><code>function isBigEnough(element, index, array) {         return (element &gt;= 10);  }          var passed = [12, 5, 8, 130, 44].every(isBigEnough);  console.log(&quot;Test Value : &quot; + passed ); // false</code></td>
</tr>
<tr>
<td style="text-align:center">3.</td>
<td style="text-align:center">filter()检测数值元素，并返回符合条件所有元素的数组。</td>
<td style="text-align:center"><code>function isBigEnough(element, index, array) {    return (element &gt;= 10);  }            var passed = [12, 5, 8, 130, 44].filter(isBigEnough);  console.log(&quot;Test Value : &quot; + passed ); // 12,130,44</code></td>
</tr>
<tr>
<td style="text-align:center">4.</td>
<td style="text-align:center">forEach()数组每个元素都执行一次回调函数。</td>
<td style="text-align:center"><code>let num = [7, 8, 9]; num.forEach(function (value) {    console.log(value); });</code>编译成 JavaScript 代码：<code>var num = [7, 8, 9]; num.forEach(function (value) {    console.log(value);  // 7   8   9 });</code></td>
</tr>
<tr>
<td style="text-align:center">5.</td>
<td style="text-align:center">indexOf()搜索数组中的元素，并返回它所在的位置。</td>
<td style="text-align:center"><code>var index = [12, 5, 8, 130, 44].indexOf(8);  console.log(&quot;index is : &quot; + index );  // 2</code></td>
</tr>
<tr>
<td style="text-align:center">6.</td>
<td style="text-align:center">join()把数组的所有元素放入一个字符串。</td>
<td style="text-align:center"><code>var arr = new Array(&quot;First&quot;,&quot;Second&quot;,&quot;Third&quot;);            var str = arr.join();  console.log(&quot;str : &quot; + str );  // First,Second,Third            var str = arr.join(&quot;, &quot;);  console.log(&quot;str : &quot; + str );  // First, Second, Third           var str = arr.join(&quot; + &quot;);  console.log(&quot;str : &quot; + str );  // First + Second + Third</code></td>
</tr>
<tr>
<td style="text-align:center">7.</td>
<td style="text-align:center">lastIndexOf()返回一个指定的字符串值最后出现的位置，在一个字符串中的指定位置从后向前搜索。</td>
<td style="text-align:center"><code>var index = [12, 5, 8, 130, 44].lastIndexOf(8);  console.log(&quot;index is : &quot; + index );  // 2</code></td>
</tr>
<tr>
<td style="text-align:center">8.</td>
<td style="text-align:center">map()通过指定函数处理数组的每个元素，并返回处理后的数组。</td>
<td style="text-align:center"><code>var numbers = [1, 4, 9];  var roots = numbers.map(Math.sqrt);  console.log(&quot;roots is : &quot; + roots );  // 1,2,3</code></td>
</tr>
<tr>
<td style="text-align:center">9.</td>
<td style="text-align:center">pop()删除数组的最后一个元素并返回删除的元素。</td>
<td style="text-align:center"><code>var numbers = [1, 4, 9];            var element = numbers.pop();  console.log(&quot;element is : &quot; + element );  // 9           var element = numbers.pop();  console.log(&quot;element is : &quot; + element );  // 4</code></td>
</tr>
<tr>
<td style="text-align:center">10.</td>
<td style="text-align:center">push()向数组的末尾添加一个或更多元素，并返回新的长度。</td>
<td style="text-align:center"><code>var numbers = new Array(1, 4, 9);  var length = numbers.push(10);  console.log(&quot;new numbers is : &quot; + numbers );  // 1,4,9,10  length = numbers.push(20);  console.log(&quot;new numbers is : &quot; + numbers );  // 1,4,9,10,20</code></td>
</tr>
<tr>
<td style="text-align:center">11.</td>
<td style="text-align:center">reduce()将数组元素计算为一个值（从左到右）。</td>
<td style="text-align:center"><code>var total = [0, 1, 2, 3].reduce(function(a, b){ return a + b; });  console.log(&quot;total is : &quot; + total );  // 6</code></td>
</tr>
<tr>
<td style="text-align:center">12.</td>
<td style="text-align:center">reduceRight()将数组元素计算为一个值（从右到左）。</td>
<td style="text-align:center"><code>var total = [0, 1, 2, 3].reduceRight(function(a, b){ return a + b; });  console.log(&quot;total is : &quot; + total );  // 6</code></td>
</tr>
<tr>
<td style="text-align:center">13.</td>
<td style="text-align:center">reverse()反转数组的元素顺序。</td>
<td style="text-align:center"><code>var arr = [0, 1, 2, 3].reverse();  console.log(&quot;Reversed array is : &quot; + arr );  // 3,2,1,0</code></td>
</tr>
<tr>
<td style="text-align:center">14.</td>
<td style="text-align:center">shift()删除并返回数组的第一个元素。</td>
<td style="text-align:center"><code>var arr = [10, 1, 2, 3].shift();  console.log(&quot;Shifted value is : &quot; + arr );  // 10</code></td>
</tr>
<tr>
<td style="text-align:center">15.</td>
<td style="text-align:center">slice()选取数组的的一部分，并返回一个新数组。</td>
<td style="text-align:center"><code>var arr = [&quot;orange&quot;, &quot;mango&quot;, &quot;banana&quot;, &quot;sugar&quot;, &quot;tea&quot;];  console.log(&quot;arr.slice( 1, 2) : &quot; + arr.slice( 1, 2) );  // mango console.log(&quot;arr.slice( 1, 3) : &quot; + arr.slice( 1, 3) );  // mango,banana</code></td>
</tr>
<tr>
<td style="text-align:center">16.</td>
<td style="text-align:center">some()检测数组元素中是否有元素符合指定条件。</td>
<td style="text-align:center"><code>function isBigEnough(element, index, array) {    return (element &gt;= 10);            }            var retval = [2, 5, 8, 1, 4].some(isBigEnough); console.log(&quot;Returned value is : &quot; + retval );  // false           var retval = [12, 5, 8, 1, 4].some(isBigEnough);  console.log(&quot;Returned value is : &quot; + retval );  // true</code></td>
</tr>
<tr>
<td style="text-align:center">17.</td>
<td style="text-align:center">sort()对数组的元素进行排序。</td>
<td style="text-align:center"><code>var arr = new Array(&quot;orange&quot;, &quot;mango&quot;, &quot;banana&quot;, &quot;sugar&quot;);  var sorted = arr.sort();  console.log(&quot;Returned string is : &quot; + sorted );  // banana,mango,orange,sugar</code></td>
</tr>
<tr>
<td style="text-align:center">18.</td>
<td style="text-align:center">splice()从数组中添加或删除元素。</td>
<td style="text-align:center"><code>var arr = [&quot;orange&quot;, &quot;mango&quot;, &quot;banana&quot;, &quot;sugar&quot;, &quot;tea&quot;];   var removed = arr.splice(2, 0, &quot;water&quot;);   console.log(&quot;After adding 1: &quot; + arr );    // orange,mango,water,banana,sugar,tea  console.log(&quot;removed is: &quot; + removed);            removed = arr.splice(3, 1);   console.log(&quot;After removing 1: &quot; + arr );  // orange,mango,water,sugar,tea  console.log(&quot;removed is: &quot; + removed);  // banana</code></td>
</tr>
<tr>
<td style="text-align:center">19.</td>
<td style="text-align:center">toString()把数组转换为字符串，并返回结果。</td>
<td style="text-align:center"><code>var arr = new Array(&quot;orange&quot;, &quot;mango&quot;, &quot;banana&quot;, &quot;sugar&quot;);          var str = arr.toString();  console.log(&quot;Returned string is : &quot; + str );  // orange,mango,banana,sugar</code></td>
</tr>
<tr>
<td style="text-align:center">20.</td>
<td style="text-align:center">unshift()向数组的开头添加一个或更多元素，并返回新的长度。</td>
<td style="text-align:center"><code>var arr = new Array(&quot;orange&quot;, &quot;mango&quot;, &quot;banana&quot;, &quot;sugar&quot;);  var length = arr.unshift(&quot;water&quot;);  console.log(&quot;Returned array is : &quot; + arr );  // water,orange,mango,banana,sugar  console.log(&quot;Length of the array is : &quot; + length ); // 5</code></td>
</tr>
</tbody>
</table>
</div>
<h3 id="元组"><a href="#元组" class="headerlink" title="元组"></a>元组</h3><p>元组中允许存储不同类型的元素，元组可以作为参数传递给函数。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> tuple_name = [value1,value2,value3,…value n]</span><br></pre></td></tr></table></figure>
<p>两个函数向元组添加新元素或者删除元素：</p>
<ul>
<li>push() 向元组添加元素，添加在最后面。</li>
<li>pop() 从元组中移除元素（最后一个），并返回移除的元素。</li>
</ul>
<p>解构元组</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> a =[<span class="number">10</span>,<span class="string">"Runoob"</span>] </span><br><span class="line"><span class="keyword">var</span> [b,c] = a </span><br><span class="line"><span class="built_in">console</span>.log( b )    </span><br><span class="line"><span class="built_in">console</span>.log( c )</span><br></pre></td></tr></table></figure>
<h3 id="联合类型"><a href="#联合类型" class="headerlink" title="联合类型"></a>联合类型</h3><p>联合类型（Union Types）可以通过管道(|)将变量设置多种类型，赋值时可以根据设置的类型来赋值。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Type1|Type2|Type3</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> val:<span class="built_in">string</span>|<span class="built_in">number</span> </span><br><span class="line">val = <span class="number">12</span> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"数字为 "</span>+ val) </span><br><span class="line">val = <span class="string">"Runoob"</span> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"字符串为 "</span> + val)</span><br></pre></td></tr></table></figure>
<p>将数组声明为联合类型：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr:<span class="built_in">number</span>[]|<span class="built_in">string</span>[]; </span><br><span class="line"><span class="keyword">var</span> i:<span class="built_in">number</span>; </span><br><span class="line">arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">4</span>] </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"**数字数组**"</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;arr.length;i++) &#123; </span><br><span class="line">   <span class="built_in">console</span>.log(arr[i]) </span><br><span class="line">&#125;  </span><br><span class="line"> </span><br><span class="line">arr = [<span class="string">"Runoob"</span>,<span class="string">"Google"</span>,<span class="string">"Taobao"</span>] </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"**字符串数字**"</span>)  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">for</span>(i = <span class="number">0</span>;i&lt;arr.length;i++) &#123; </span><br><span class="line">   <span class="built_in">console</span>.log(arr[i]) </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="接口"><a href="#接口" class="headerlink" title="接口"></a>接口</h2><p>接口是一系列抽象方法的声明，是一些方法特征的集合，这些方法都应该是抽象的，需要由具体的类去实现，然后第三方就可以通过这组抽象方法调用，让具体的类执行具体的方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> interface_name &#123; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>实例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPerson &#123; </span><br><span class="line">    firstName:<span class="built_in">string</span>, </span><br><span class="line">    lastName:<span class="built_in">string</span>, </span><br><span class="line">    sayHi: <span class="function"><span class="params">()</span>=&gt;</span><span class="built_in">string</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> customer:IPerson = &#123; </span><br><span class="line">    firstName:<span class="string">"Tom"</span>,</span><br><span class="line">    lastName:<span class="string">"Hanks"</span>, </span><br><span class="line">    sayHi: ():<span class="function"><span class="params">string</span> =&gt;</span>&#123;<span class="keyword">return</span> <span class="string">"Hi there"</span>&#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Customer 对象 "</span>) </span><br><span class="line"><span class="built_in">console</span>.log(customer.firstName) </span><br><span class="line"><span class="built_in">console</span>.log(customer.lastName) </span><br><span class="line"><span class="built_in">console</span>.log(customer.sayHi())  </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> employee:IPerson = &#123; </span><br><span class="line">    firstName:<span class="string">"Jim"</span>,</span><br><span class="line">    lastName:<span class="string">"Blakes"</span>, </span><br><span class="line">    sayHi: ():<span class="function"><span class="params">string</span> =&gt;</span>&#123;<span class="keyword">return</span> <span class="string">"Hello!!!"</span>&#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Employee  对象 "</span>) </span><br><span class="line"><span class="built_in">console</span>.log(employee.firstName) </span><br><span class="line"><span class="built_in">console</span>.log(employee.lastName)</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> customer = &#123;</span><br><span class="line">    firstName: <span class="string">"Tom"</span>,</span><br><span class="line">    lastName: <span class="string">"Hanks"</span>,</span><br><span class="line">    sayHi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"Hi there"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Customer 对象 "</span>);</span><br><span class="line"><span class="built_in">console</span>.log(customer.firstName);</span><br><span class="line"><span class="built_in">console</span>.log(customer.lastName);</span><br><span class="line"><span class="built_in">console</span>.log(customer.sayHi());</span><br><span class="line"><span class="keyword">var</span> employee = &#123;</span><br><span class="line">    firstName: <span class="string">"Jim"</span>,</span><br><span class="line">    lastName: <span class="string">"Blakes"</span>,</span><br><span class="line">    sayHi: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"Hello!!!"</span>; &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"Employee  对象 "</span>);</span><br><span class="line"><span class="built_in">console</span>.log(employee.firstName);</span><br><span class="line"><span class="built_in">console</span>.log(employee.lastName);</span><br></pre></td></tr></table></figure>
<p>联合类型和接口</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> RunOptions &#123; </span><br><span class="line">    program:<span class="built_in">string</span>; </span><br><span class="line">    commandline:<span class="built_in">string</span>[]|<span class="built_in">string</span>|<span class="function">(<span class="params">(<span class="params"></span>)=&gt;<span class="built_in">string</span></span>); </span></span><br><span class="line"><span class="function">&#125; </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">// <span class="params">commandline</span> 是字符串</span></span><br><span class="line"><span class="function"><span class="params">var</span> <span class="params">options</span>:<span class="params">RunOptions</span> = &#123;<span class="params">program</span>:"<span class="params">test1</span>",<span class="params">commandline</span>:"<span class="params">Hello</span>"&#125;; </span></span><br><span class="line"><span class="function"><span class="params">console</span>.<span class="params">log</span>(<span class="params">options.commandline</span>)  </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">// <span class="params">commandline</span> 是字符串数组</span></span><br><span class="line"><span class="function"><span class="params">options</span> = &#123;<span class="params">program</span>:"<span class="params">test1</span>",<span class="params">commandline</span>:["<span class="params">Hello</span>","<span class="params">World</span>"]&#125;; </span></span><br><span class="line"><span class="function"><span class="params">console</span>.<span class="params">log</span>(<span class="params">options.commandline[0]</span>); </span></span><br><span class="line"><span class="function"><span class="params">console</span>.<span class="params">log</span>(<span class="params">options.commandline[1]</span>);  </span></span><br><span class="line"><span class="function"> </span></span><br><span class="line"><span class="function">// <span class="params">commandline</span> 是一个函数表达式</span></span><br><span class="line"><span class="function"><span class="params">options</span> = &#123;<span class="params">program</span>:"<span class="params">test1</span>",<span class="params">commandline</span>:<span class="params">()</span>=&gt;</span>&#123;<span class="keyword">return</span> <span class="string">"**Hello World**"</span>;&#125;&#125;; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> fn:<span class="built_in">any</span> = options.commandline; </span><br><span class="line"><span class="built_in">console</span>.log(fn());</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// commandline 是字符串</span></span><br><span class="line"><span class="keyword">var</span> options = &#123; <span class="attr">program</span>: <span class="string">"test1"</span>, <span class="attr">commandline</span>: <span class="string">"Hello"</span> &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(options.commandline);</span><br><span class="line"><span class="comment">// commandline 是字符串数组</span></span><br><span class="line">options = &#123; <span class="attr">program</span>: <span class="string">"test1"</span>, <span class="attr">commandline</span>: [<span class="string">"Hello"</span>, <span class="string">"World"</span>] &#125;;</span><br><span class="line"><span class="built_in">console</span>.log(options.commandline[<span class="number">0</span>]);</span><br><span class="line"><span class="built_in">console</span>.log(options.commandline[<span class="number">1</span>]);</span><br><span class="line"><span class="comment">// commandline 是一个函数表达式</span></span><br><span class="line">options = &#123; <span class="attr">program</span>: <span class="string">"test1"</span>, <span class="attr">commandline</span>: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="keyword">return</span> <span class="string">"**Hello World**"</span>; &#125; &#125;;</span><br><span class="line"><span class="keyword">var</span> fn = options.commandline;</span><br><span class="line"><span class="built_in">console</span>.log(fn());</span><br></pre></td></tr></table></figure>
<p>接口和数组</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> namelist &#123; </span><br><span class="line">   [index:<span class="built_in">number</span>]:<span class="built_in">string</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> list2:namelist = [<span class="string">"John"</span>,<span class="number">1</span>,<span class="string">"Bran"</span>] / 错误元素 <span class="number">1</span> 不是 <span class="built_in">string</span> 类型</span><br><span class="line"><span class="keyword">interface</span> ages &#123; </span><br><span class="line">   [index:<span class="built_in">string</span>]:<span class="built_in">number</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> agelist:ages; </span><br><span class="line">agelist[<span class="string">"John"</span>] = <span class="number">15</span>   <span class="comment">// 正确 </span></span><br><span class="line">agelist[<span class="number">2</span>] = <span class="string">"nine"</span>   <span class="comment">// 错误</span></span><br></pre></td></tr></table></figure>
<p>接口继承</p>
<p>接口继承就是说接口可以通过其他接口来扩展自己。</p>
<p>Typescript 允许接口继承多个接口。</p>
<p>继承使用关键字 <strong>extends</strong>。</p>
<p>单接口继承语法格式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Child_interface_name <span class="keyword">extends</span> super_interface_name</span><br></pre></td></tr></table></figure>
<p>多接口继承语法格式：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Child_interface_name <span class="keyword">extends</span> super_interface1_name, super_interface2_name,…,super_interfaceN_name</span><br></pre></td></tr></table></figure>
<h2 id="类和对象"><a href="#类和对象" class="headerlink" title="类和对象"></a>类和对象</h2><p>TypeScript 是面向对象的 JavaScript。</p>
<p>类描述了所创建的对象共同的属性和方法。</p>
<p>TypeScript 支持面向对象的所有特性，比如 类、接口等。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> class_name &#123; </span><br><span class="line">    <span class="comment">// 类作用域</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>定义类的关键字为 class，后面紧跟类名，类可以包含以下几个模块（类的数据成员）：</p>
<ul>
<li><strong>字段</strong> − 字段是类里面声明的变量。字段表示对象的有关数据。</li>
<li><strong>构造函数</strong> − 类实例化时调用，可以为类的对象分配内存。</li>
<li><strong>方法</strong> − 方法为对象要执行的操作。</li>
</ul>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Car &#123; </span><br><span class="line">    <span class="comment">// 字段 </span></span><br><span class="line">    engine:<span class="built_in">string</span>; </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 构造函数 </span></span><br><span class="line">    <span class="keyword">constructor</span>(<span class="params">engine:<span class="built_in">string</span></span>) &#123; </span><br><span class="line">        <span class="keyword">this</span>.engine = engine </span><br><span class="line">    &#125;  </span><br><span class="line"> </span><br><span class="line">    <span class="comment">// 方法 </span></span><br><span class="line">    disp():<span class="built_in">void</span> &#123; </span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"发动机为 :   "</span>+<span class="keyword">this</span>.engine) </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>编译得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Car = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 构造函数 </span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">Car</span>(<span class="params">engine</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.engine = engine;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 方法 </span></span><br><span class="line">    Car.prototype.disp = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">"发动机为 :   "</span> + <span class="keyword">this</span>.engine);</span><br><span class="line">    &#125;;</span><br><span class="line">    <span class="keyword">return</span> Car;</span><br><span class="line">&#125;());</span><br></pre></td></tr></table></figure>
<p>创建实例化对象</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object_name = <span class="keyword">new</span> class_name([ <span class="built_in">arguments</span> ])</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">obj.field_name </span><br><span class="line"></span><br><span class="line"><span class="comment">// 访问方法</span></span><br><span class="line">obj.function_name()</span><br></pre></td></tr></table></figure>
<p>完整案例</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Car &#123; </span><br><span class="line">   <span class="comment">// 字段</span></span><br><span class="line">   engine:<span class="built_in">string</span>; </span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 构造函数</span></span><br><span class="line">   <span class="keyword">constructor</span>(<span class="params">engine:<span class="built_in">string</span></span>) &#123; </span><br><span class="line">      <span class="keyword">this</span>.engine = engine </span><br><span class="line">   &#125;  </span><br><span class="line">   </span><br><span class="line">   <span class="comment">// 方法</span></span><br><span class="line">   disp():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"函数中显示发动机型号  :   "</span>+<span class="keyword">this</span>.engine) </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 创建一个对象</span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Car(<span class="string">"XXSY1"</span>)</span><br><span class="line"> </span><br><span class="line"><span class="comment">// 访问字段</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"读取发动机型号 :  "</span>+obj.engine)  </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 访问方法</span></span><br><span class="line">obj.disp()</span><br></pre></td></tr></table></figure>
<p>TypeScript 支持继承类，即我们可以在创建类的时候继承一个已存在的类，这个已存在的类称为父类，继承它的类称为子类。</p>
<p>类继承使用关键字 <strong>extends</strong>，子类除了不能继承父类的私有成员(方法和属性)和构造函数，其他的都可以继承。</p>
<p>TypeScript 一次只能继承一个类，不支持继承多个类，但 TypeScript 支持多重继承（A 继承 B，B 继承 C）。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> child_class_name <span class="keyword">extends</span> parent_class_name</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Shape &#123; </span><br><span class="line">   Area:<span class="built_in">number</span> </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">constructor</span>(<span class="params">a:<span class="built_in">number</span></span>) &#123; </span><br><span class="line">      <span class="keyword">this</span>.Area = a </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> Circle <span class="keyword">extends</span> Shape &#123; </span><br><span class="line">   disp():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"圆的面积:  "</span>+<span class="keyword">this</span>.Area) </span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br><span class="line">  </span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Circle(<span class="number">223</span>); </span><br><span class="line">obj.disp()</span><br></pre></td></tr></table></figure>
<p>类继承后，子类可以对父类的方法重新定义，这个过程称之为方法的重写。</p>
<p>其中 super 关键字是对父类的直接引用，该关键字可以引用父类的属性和方法。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> PrinterClass &#123; </span><br><span class="line">   doPrint():<span class="built_in">void</span> &#123;</span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"父类的 doPrint() 方法。"</span>) </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> StringPrinter <span class="keyword">extends</span> PrinterClass &#123; </span><br><span class="line">   doPrint():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="keyword">super</span>.doPrint() <span class="comment">// 调用父类的函数</span></span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"子类的 doPrint()方法。"</span>)</span><br><span class="line">   &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>static 关键字用于定义类的数据成员（属性和方法）为静态的，静态成员可以直接通过类名调用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> StaticMem &#123;  </span><br><span class="line">   <span class="keyword">static</span> num:<span class="built_in">number</span>; </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">static</span> disp():<span class="built_in">void</span> &#123; </span><br><span class="line">      <span class="built_in">console</span>.log(<span class="string">"num 值为 "</span>+ StaticMem.num) </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line">StaticMem.num = <span class="number">12</span>     <span class="comment">// 初始化静态变量</span></span><br><span class="line">StaticMem.disp()</span><br></pre></td></tr></table></figure>
<p>instanceof 运算符用于判断对象是否是指定的类型，如果是返回 true，否则返回 false。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">class</span> Person&#123; &#125; </span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Person() </span><br><span class="line"><span class="keyword">var</span> isPerson = obj <span class="keyword">instanceof</span> Person; </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"obj 对象是 Person 类实例化来的吗？ "</span> + isPerson);</span><br></pre></td></tr></table></figure>
<p>TypeScript 中，可以使用访问控制符来保护对类、变量、方法和构造方法的访问。TypeScript 支持 3 种不同的访问权限。</p>
<ul>
<li><strong>public（默认）</strong> : 公有，可以在任何地方被访问。</li>
<li><strong>protected</strong> : 受保护，可以被其自身以及其子类和父类访问。</li>
<li><strong>private</strong> : 私有，只能被其定义所在的类访问。</li>
</ul>
<p>类可以实现接口，使用关键字 implements，并将 interest 字段作为类的属性使用。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> ILoan &#123; </span><br><span class="line">   interest:<span class="built_in">number</span> </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">class</span> AgriLoan <span class="keyword">implements</span> ILoan &#123; </span><br><span class="line">   interest:<span class="built_in">number</span> </span><br><span class="line">   rebate:<span class="built_in">number</span> </span><br><span class="line">   </span><br><span class="line">   <span class="keyword">constructor</span>(<span class="params">interest:<span class="built_in">number</span>,rebate:<span class="built_in">number</span></span>) &#123; </span><br><span class="line">      <span class="keyword">this</span>.interest = interest </span><br><span class="line">      <span class="keyword">this</span>.rebate = rebate </span><br><span class="line">   &#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> AgriLoan(<span class="number">10</span>,<span class="number">1</span>) </span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">"利润为 : "</span>+obj.interest+<span class="string">"，抽成为 : "</span>+obj.rebate )</span><br></pre></td></tr></table></figure>
<p>对象是包含一组键值对的实例。 值可以是标量、函数、数组、对象等，如下实例：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> object_name = &#123; </span><br><span class="line">    key1: <span class="string">"value1"</span>, <span class="comment">// 标量</span></span><br><span class="line">    key2: <span class="string">"value"</span>,  </span><br><span class="line">    key3: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// 函数</span></span><br><span class="line">    &#125;, </span><br><span class="line">    key4:[<span class="string">"content1"</span>, <span class="string">"content2"</span>] <span class="comment">//集合</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sites = &#123;</span><br><span class="line">    site1: <span class="string">"Runoob"</span>,</span><br><span class="line">    site2: <span class="string">"Google"</span>,</span><br><span class="line">    sayHello: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; &#125; <span class="comment">// 类型模板</span></span><br><span class="line">&#125;;</span><br><span class="line">sites.sayHello = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"hello "</span> + sites.site1);</span><br><span class="line">&#125;;</span><br><span class="line">sites.sayHello();</span><br></pre></td></tr></table></figure>
<p>对象也可以作为一个参数传递给函数</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> sites = &#123; </span><br><span class="line">    site1:<span class="string">"Runoob"</span>, </span><br><span class="line">    site2:<span class="string">"Google"</span>,</span><br><span class="line">&#125;; </span><br><span class="line"><span class="keyword">var</span> invokesites = <span class="function"><span class="keyword">function</span>(<span class="params">obj: &#123; site1:<span class="built_in">string</span>, site2 :<span class="built_in">string</span> &#125;</span>) </span>&#123; </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"site1 :"</span>+obj.site1) </span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">"site2 :"</span>+obj.site2) </span><br><span class="line">&#125; </span><br><span class="line">invokesites(sites)</span><br></pre></td></tr></table></figure>
<p>鸭子类型（Duck Typing）</p>
<p>鸭子类型（英语：duck typing）是动态类型的一种风格，是多态(polymorphism)的一种形式。</p>
<p>在这种风格中，一个对象有效的语义，不是由继承自特定的类或实现特定的接口，而是由”当前方法和属性的集合”决定。</p>
<p>在鸭子类型中，关注点在于对象的行为，能作什么；而不是关注对象所属的类型。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">interface</span> IPoint &#123; </span><br><span class="line">    x:<span class="built_in">number</span> </span><br><span class="line">    y:<span class="built_in">number</span> </span><br><span class="line">&#125; </span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">addPoints</span>(<span class="params">p1:IPoint,p2:IPoint</span>):<span class="title">IPoint</span> </span>&#123; </span><br><span class="line">    <span class="keyword">var</span> x = p1.x + p2.x </span><br><span class="line">    <span class="keyword">var</span> y = p1.y + p2.y </span><br><span class="line">    <span class="keyword">return</span> &#123;x:x,y:y&#125; </span><br><span class="line">&#125; </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 正确</span></span><br><span class="line"><span class="keyword">var</span> newPoint = addPoints(&#123;x:<span class="number">3</span>,y:<span class="number">4</span>&#125;,&#123;x:<span class="number">5</span>,y:<span class="number">1</span>&#125;)  </span><br><span class="line"> </span><br><span class="line"><span class="comment">// 错误 </span></span><br><span class="line"><span class="keyword">var</span> newPoint2 = addPoints(&#123;x:<span class="number">1</span>&#125;,&#123;x:<span class="number">4</span>,y:<span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<h2 id="命名空间"><a href="#命名空间" class="headerlink" title="命名空间"></a>命名空间</h2><p>命名空间一个最明确的目的就是解决重名问题。</p>
<p>TypeScript 中命名空间使用 <strong>namespace</strong> 来定义，语法格式如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> SomeNameSpaceName &#123; </span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">interface</span> ISomeInterfaceName &#123;      &#125;  </span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">class</span> SomeClassName &#123;      &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以上定义了一个命名空间 SomeNameSpaceName，如果我们需要在外部可以调用 SomeNameSpaceName 中的类和接口，则需要在类和接口添加 <strong>export</strong> 关键字。</p>
<p>要在另外一个命名空间调用语法格式为：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">SomeNameSpaceName.SomeClassName;</span><br></pre></td></tr></table></figure>
<p>如果一个命名空间在一个单独的 TypeScript 文件中，则应使用三斜杠 /// 引用它，语法格式如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "SomeFileName.ts" /&gt;</span></span><br></pre></td></tr></table></figure>
<p>IShape.ts 文件代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> Drawing &#123; </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">interface</span> IShape &#123; </span><br><span class="line">        draw(); </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Circle.ts 文件嗲名</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt; </span></span><br><span class="line"><span class="keyword">namespace</span> Drawing &#123; </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> Circle <span class="keyword">implements</span> IShape &#123; </span><br><span class="line">        <span class="keyword">public</span> draw() &#123; </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Circle is drawn"</span>); </span><br><span class="line">        &#125;  </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>Triangle.ts 文件代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt; </span></span><br><span class="line"><span class="keyword">namespace</span> Drawing &#123; </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">class</span> Triangle <span class="keyword">implements</span> IShape &#123; </span><br><span class="line">        <span class="keyword">public</span> draw() &#123; </span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Triangle is drawn"</span>); </span><br><span class="line">        &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt;   </span></span><br><span class="line"><span class="comment">/// &lt;reference path = "Circle.ts" /&gt; </span></span><br><span class="line"><span class="comment">/// &lt;reference path = "Triangle.ts" /&gt;  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawAllShapes</span>(<span class="params">shape:Drawing.IShape</span>) </span>&#123; </span><br><span class="line">    shape.draw(); </span><br><span class="line">&#125; </span><br><span class="line">drawAllShapes(<span class="keyword">new</span> Drawing.Circle());</span><br><span class="line">drawAllShapes(<span class="keyword">new</span> Drawing.Triangle());</span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">tsc --out app.js TestShape.ts</span><br></pre></td></tr></table></figure>
<p>得到</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt; </span></span><br><span class="line"><span class="keyword">var</span> Drawing;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">Drawing</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Circle = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Circle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        Circle.prototype.draw = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Circle is drawn"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> Circle;</span><br><span class="line">    &#125;());</span><br><span class="line">    Drawing.Circle = Circle;</span><br><span class="line">&#125;)(Drawing || (Drawing = &#123;&#125;));</span><br><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt; </span></span><br><span class="line"><span class="keyword">var</span> Drawing;</span><br><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params">Drawing</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Triangle = <span class="comment">/** @class */</span> (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Triangle</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        &#125;</span><br><span class="line">        Triangle.prototype.draw = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">"Triangle is drawn"</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="keyword">return</span> Triangle;</span><br><span class="line">    &#125;());</span><br><span class="line">    Drawing.Triangle = Triangle;</span><br><span class="line">&#125;)(Drawing || (Drawing = &#123;&#125;));</span><br><span class="line"><span class="comment">/// &lt;reference path = "IShape.ts" /&gt;   </span></span><br><span class="line"><span class="comment">/// &lt;reference path = "Circle.ts" /&gt; </span></span><br><span class="line"><span class="comment">/// &lt;reference path = "Triangle.ts" /&gt;  </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">drawAllShapes</span>(<span class="params">shape</span>) </span>&#123;</span><br><span class="line">    shape.draw();</span><br><span class="line">&#125;</span><br><span class="line">drawAllShapes(<span class="keyword">new</span> Drawing.Circle());</span><br><span class="line">drawAllShapes(<span class="keyword">new</span> Drawing.Triangle());</span><br></pre></td></tr></table></figure>
<p>命名空间支持嵌套，即你可以将命名空间定义在另外一个命名空间里头。</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">namespace</span> namespace_name1 &#123; </span><br><span class="line">    <span class="keyword">export</span> <span class="keyword">namespace</span> namespace_name2 &#123;</span><br><span class="line">        <span class="keyword">export</span> <span class="keyword">class</span> class_name &#123;    &#125; </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h2 id="模块"><a href="#模块" class="headerlink" title="模块"></a>模块</h2><p>TypeScript 模块的设计理念是可以更换的组织代码。</p>
<p>模块是在其自身的作用域里执行，并不是在全局作用域，这意味着定义在模块里面的变量、函数和类等在模块外部是不可见的，除非明确地使用 export 导出它们。类似地，我们必须通过 import 导入其他模块导出的变量、函数、类等。</p>
<p>两个模块之间的关系是通过在文件级别上使用 import 和 export 建立的。</p>
<p>模块使用模块加载器去导入其它的模块。 在运行时，模块加载器的作用是在执行此模块代码前去查找并执行这个模块的所有依赖。</p>
<p>模块导出使用关键字 <strong>export</strong> 关键字，语法格式如下：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 文件名 : SomeInterface.ts </span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">interface</span> SomeInterface &#123; </span><br><span class="line">   <span class="comment">// 代码部分</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> someInterfaceRef = <span class="built_in">require</span>(<span class="string">"./SomeInterface"</span>);</span><br></pre></td></tr></table></figure>
<h2 id="声明文件"><a href="#声明文件" class="headerlink" title="声明文件"></a>声明文件</h2><blockquote>
<p>TypeScript 作为 JavaScript 的超集，在开发过程中不可避免要引用其他第三方的 JavaScript 的库。虽然通过直接引用可以调用库的类和方法，但是却无法使用TypeScript 诸如类型检查等特性功能。为了解决这个问题，需要将这些库里的函数和方法体去掉后只保留导出类型声明，而产生了一个描述 JavaScript 库和模块信息的声明文件。通过引用这个声明文件，就可以借用 TypeScript 的各种特性来使用库文件了。</p>
</blockquote>
<p>假如我们想使用第三方库，比如 jQuery，我们通常这样获取一个 id 是 foo 的元素：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$(&#39;#foo&#39;);</span><br><span class="line">&#x2F;&#x2F; 或</span><br><span class="line">jQuery(&#39;#foo&#39;);</span><br></pre></td></tr></table></figure>
<p>但是在 TypeScript 中，我们并不知道 $ 或 jQuery 是什么东西：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">jQuery(&#39;#foo&#39;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F; index.ts(1,1): error TS2304: Cannot find name &#39;jQuery&#39;.</span><br></pre></td></tr></table></figure>
<p>这时，我们需要使用 declare 关键字来定义它的类型，帮助 TypeScript 判断我们传入的参数类型对不对：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">declare var jQuery: (selector: string) &#x3D;&gt; any;</span><br><span class="line"></span><br><span class="line">jQuery(&#39;#foo&#39;);</span><br></pre></td></tr></table></figure>
<p>declare 定义的类型只会用于编译时的检查，编译结果中会被删除。</p>
<p>上例的编译结果是：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">jQuery(&#39;#foo&#39;);</span><br></pre></td></tr></table></figure>
<p>声明文件以 <strong>.d.ts</strong> 为后缀，例如：</p>
<p>声明文件或模块的语法格式如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">declare module Module_Name &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>TypeScript 引入声明文件语法格式：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#x2F;&#x2F;&#x2F; &lt;reference path &#x3D; &quot; runoob.d.ts&quot; &#x2F;&gt;</span><br></pre></td></tr></table></figure>
<p>当然，很多流行的第三方库的声明文件不需要我们定义了，比如 jQuery 已经有人帮我们定义好了：<a href="https://github.com/DefinitelyTyped/DefinitelyTyped/tree/master/types/jquery/index.d.ts" target="_blank" rel="noopener">jQuery in DefinitelyTyped</a>。</p>
<p>CalcThirdPartyJsLib.js 文件代码：</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> Runoob;  </span><br><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params">Runoob</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Calc = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; </span><br><span class="line">        <span class="function"><span class="keyword">function</span> <span class="title">Calc</span>(<span class="params"></span>) </span>&#123; </span><br><span class="line">        &#125; </span><br><span class="line">    &#125;)</span><br><span class="line">    Calc.prototype.doSum = <span class="function"><span class="keyword">function</span> (<span class="params">limit</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> sum = <span class="number">0</span>; </span><br><span class="line"> </span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt;= limit; i++) &#123; </span><br><span class="line">            sum = sum + i; </span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> sum; </span><br><span class="line">    &#125;</span><br><span class="line">    Runoob.Calc = Calc; </span><br><span class="line">    <span class="keyword">return</span> Calc; </span><br><span class="line">&#125;)(Runoob || (Runoob = &#123;&#125;)); </span><br><span class="line"><span class="keyword">var</span> test = <span class="keyword">new</span> Runoob.Calc();</span><br></pre></td></tr></table></figure>
<p>Calc.d.ts 文件代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">declare</span> <span class="keyword">module</span> Runoob &#123; </span><br><span class="line">   <span class="keyword">export</span> <span class="keyword">class</span> Calc &#123; </span><br><span class="line">      doSum(limit:<span class="built_in">number</span>) : <span class="built_in">number</span>; </span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>声明文件不包含实现，它只是类型声明，把声明文件加入到 TypeScript 中：</p>
<p>CalcTest.ts 文件代码</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/// &lt;reference path = "Calc.d.ts" /&gt; </span></span><br><span class="line"><span class="keyword">var</span> obj = <span class="keyword">new</span> Runoob.Calc(); </span><br><span class="line"><span class="comment">// obj.doSum("Hello"); // 编译错误</span></span><br><span class="line"><span class="built_in">console</span>.log(obj.doSum(<span class="number">10</span>));</span><br></pre></td></tr></table></figure>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><p><a href="https://www.runoob.com/typescript" target="_blank" rel="noopener">https://www.runoob.com/typescript</a></p>
<p>大部分资料来源于上面网站</p>

      
    </div>

    
    
    
      <footer class="post-footer">
        <div class="post-eof"></div>
      </footer>
  </article>
  
  
  


  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><span class="space">&hellip;</span><a class="page-number" href="/page/6/">6</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="下一页"></i></a>
  </nav>



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">DongxianGu</p>
  <div class="site-description" itemprop="description">Life,Happy,Code</div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">57</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">12</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
        <span class="site-state-item-count">2</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2020</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Jiangsu,Dongxian</span>
</div>
  <div class="powered-by">由 <a href="https://hexo.io/" class="theme-link" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.org/" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> 强力驱动
  </div>

        








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  
      

<script>
  if (typeof MathJax === 'undefined') {
    window.MathJax = {
      loader: {
        source: {
          '[tex]/amsCd': '[tex]/amscd',
          '[tex]/AMScd': '[tex]/amscd'
        }
      },
      tex: {
        inlineMath: {'[+]': [['$', '$']]},
        tags: 'ams'
      },
      options: {
        renderActions: {
          findScript: [10, doc => {
            document.querySelectorAll('script[type^="math/tex"]').forEach(node => {
              const display = !!node.type.match(/; *mode=display/);
              const math = new doc.options.MathItem(node.textContent, doc.inputJax[0], display);
              const text = document.createTextNode('');
              node.parentNode.replaceChild(text, node);
              math.start = {node: text, delim: '', n: 0};
              math.end = {node: text, delim: '', n: 0};
              doc.math.push(math);
            });
          }, '', false],
          insertedScript: [200, () => {
            document.querySelectorAll('mjx-container').forEach(node => {
              let target = node.parentNode;
              if (target.nodeName.toLowerCase() === 'li') {
                target.parentNode.classList.add('has-jax');
              }
            });
          }, '', false]
        }
      }
    };
    (function () {
      var script = document.createElement('script');
      script.src = '//cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js';
      script.defer = true;
      document.head.appendChild(script);
    })();
  } else {
    MathJax.startup.document.state(0);
    MathJax.texReset();
    MathJax.typeset();
  }
</script>

    

  


<script>
NexT.utils.loadComments(document.querySelector('#valine-comments'), () => {
  NexT.utils.getScript('//unpkg.com/valine/dist/Valine.min.js', () => {
    var GUEST = ['nick', 'mail', 'link'];
    var guest = 'nick,mail,link';
    guest = guest.split(',').filter(item => {
      return GUEST.includes(item);
    });
    new Valine({
      el         : '#valine-comments',
      verify     : false,
      notify     : false,
      appId      : 'VUd8OrYllPMWVxDqLagwIGsP-gzGzoHsz',
      appKey     : 'PiWbdIfbwtkQbPbW1Fh5WN2h',
      placeholder: "Just go go",
      avatar     : 'mm',
      meta       : guest,
      pageSize   : '10' || 10,
      visitor    : false,
      lang       : '' || 'zh-cn',
      path       : location.pathname,
      recordIP   : false,
      serverURLs : ''
    });
  }, window.Valine);
});
</script>

<script src="/live2dw/lib/L2Dwidget.min.js?094cbace49a39548bed64abff5988b05"></script><script>L2Dwidget.init({"pluginRootPath":"live2dw/","pluginJsPath":"lib/","pluginModelPath":"assets/","tagMode":false,"log":false,"model":{"jsonPath":"/live2dw/assets/koharu.model.json"},"display":{"position":"right","width":150,"height":300},"mobile":{"show":true},"react":{"opacity":0.7}});</script></body>
</html>
